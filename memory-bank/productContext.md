# Product Context

This file provides a high-level overview of the project and the expected product that will be created. Initially it is based upon projectBrief.md (if provided) and all other available project-related information in the working directory. This file is intended to be updated as the project evolves, and should be used to inform all other modes of the project's goals and context.
2025-04-25 11:20:00 - Log of updates made will be appended as footnotes to the end of this file.

*

## Project Goal

Система управления обучением (LMS - Learning Management System) для образовательных учреждений, связанных с компьютерными науками и анализом данных, включая Computer Science Center, Computer Science Club и Школу анализа данных Яндекса. Система предназначена для полного цикла образовательного процесса: от приема студентов до выдачи сертификатов об окончании обучения.

## Key Features

* **Управление приемной кампанией**
  - Регистрация и обработка заявок абитуриентов
  - Проведение вступительных тестов, олимпиад и интервью
  - Управление расписанием собеседований
  - Оценка и отбор кандидатов
  - Хранение и анализ результатов олимпиад

* **Управление курсами и учебными материалами**
  - Создание и редактирование курсов
  - Управление учебными материалами (лекции, презентации, видео)
  - Расписание занятий
  - Управление преподавателями и их ролями

* **Система заданий и оценивания**
  - Создание и проверка заданий
  - Автоматическая и ручная проверка решений
  - Система оценивания и обратной связи
  - Интеграция с системами проверки кода (Yandex.Contest, Gerrit)

* **Проектная работа**
  - Управление проектами студентов
  - Назначение руководителей проектов
  - Отслеживание прогресса и оценка результатов

* **Уведомления и коммуникация**
  - Система уведомлений (email, веб)
  - Обратная связь между студентами и преподавателями

* **Интеграция с внешними сервисами**
  - Yandex.Contest (для проверки заданий и проведения олимпиад)
  - Gerrit (для код-ревью)
  - Yandex.Disk (для хранения файлов)
  - Yandex.Passport и LDAP (для аутентификации)

## Overall Architecture

Проект представляет собой многосайтовое Django-приложение с общим кодом и специфичными компонентами для каждого образовательного учреждения:

* **Сайты/поддомены:**
  - compscicenter_ru - Computer Science Center
  - compsciclub_ru - Computer Science Club
  - lk_yandexdataschool_ru - Личный кабинет Школы анализа данных Яндекса
  - lms - общий код и компоненты для всех сайтов

* **Основные компоненты:**
  - **apps/admission** - управление приемной кампанией, включая проведение олимпиад ШАД
  - **apps/courses** - управление курсами и учебными материалами
  - **apps/learning** - управление учебным процессом
  - **apps/tasks** - система заданий
  - **apps/grading** - система оценивания
  - **apps/projects** - управление проектами
  - **apps/users** - управление пользователями и их ролями
  - **apps/notifications** - система уведомлений
  - **apps/api** - REST API для взаимодействия с фронтендом и внешними сервисами
  - **apps/auth** - аутентификация и авторизация
  - **apps/code_reviews** - система код-ревью
  - **apps/stats** - сбор и анализ статистики

* **Технологический стек:**
  - Backend: Python 3.x, Django 2.2.x, PostgreSQL 11, Redis, Celery
  - API: Django REST Framework
  - Frontend: Jinja2, Webpack
  - Инфраструктура: Docker, Kubernetes

## Модуль приемной кампании (apps/admission)

Модуль приемной кампании отвечает за управление процессом приема абитуриентов, включая регистрацию заявок, проведение вступительных испытаний и отбор кандидатов.

### Основные компоненты модуля:

#### Модели данных:

* **Управление кампаниями:**
  - `Campaign` - приемная кампания с настройками сроков, проходных баллов и шаблонов писем
  - `University` / `ResidenceCity` - справочники для хранения информации об университетах и городах проживания

* **Абитуриенты:**
  - `Applicant` - информация о поступающем (личные данные, образование, опыт работы, мотивация)
  - `ApplicantStatusLog` - история изменений статуса абитуриента
  - `ApplicantQuerySet` / `ApplicantSubscribedManager` - специализированные менеджеры для работы с абитуриентами

* **Вступительные испытания:**
  - `Contest` - информация о контесте в Yandex.Contest
  - `YandexContestIntegration` - абстрактный класс для интеграции с Yandex.Contest
  - `Test` - результаты онлайн-теста
  - `Exam` - результаты экзамена
  - `Olympiad` - результаты олимпиады ШАД (программирование и математика)
  - `ApplicantRandomizeContestMixin` - миксин для распределения абитуриентов по контестам

* **Собеседования:**
  - `Interview` - собеседование с абитуриентом
  - `InterviewStream` - поток собеседований
  - `InterviewSlot` - слот для собеседования
  - `InterviewInvitation` - приглашение на собеседование
  - `InterviewAssignment` - задание для собеседования
  - `InterviewFormat` - формат проведения собеседования
  - `Comment` - комментарий интервьюера

* **Зачисление:**
  - `Acceptance` - подтверждение зачисления абитуриента

#### Сервисы:

* **Управление абитуриентами:**
  - `create_applicant_status_log` - создание записи об изменении статуса абитуриента
  - `manual_status_change` - контекстный менеджер для изменения статуса абитуриента
  - `get_applicants_for_invitation` - получение списка абитуриентов для приглашения на собеседование

* **Интеграция с Yandex.Contest:**
  - `create_contest_results_import_task` - создание задачи для импорта результатов контеста
  - `get_latest_contest_results_task` - получение последней задачи импорта результатов

* **Управление собеседованиями:**
  - `create_invitation` - создание приглашения на собеседование
  - `accept_interview_invitation` - принятие приглашения на собеседование
  - `decline_interview_invitation` - отклонение приглашения на собеседование
  - `get_streams` - получение потоков собеседований для приглашения
  - `get_meeting_time` - расчет времени начала собеседования

* **Управление зачислением:**
  - `get_acceptance_ready_to_confirm` - получение подтверждения зачисления, готового к подтверждению
  - `create_student_from_applicant` - создание учетной записи студента из абитуриента
  - `get_or_create_student_profile` - получение или создание профиля студента

* **Уведомления:**
  - `EmailQueueService` - сервис для отправки уведомлений по электронной почте
  - `send_email_verification_code` - отправка кода подтверждения электронной почты
  - `generate_verification_code` / `validate_verification_code` - генерация и проверка кода подтверждения

#### Представления:

* **Абитуриенты:**
  - `ApplicantListView` - список абитуриентов с фильтрацией и сортировкой
  - `ApplicantDetailView` - детальная информация об абитуриенте
  - `ApplicantStatusUpdateView` - обновление статуса абитуриента
  - `ApplicantCreateStudentView` - создание учетной записи студента из абитуриента
  - `RegisterApplicantsForOlympiadView` - регистрация абитуриентов в контесте олимпиады

* **Собеседования:**
  - `InterviewInvitationCreateView` - создание приглашений на собеседование
  - `InterviewInvitationListView` - список приглашений на собеседование
  - `InterviewListView` / `InterviewListCSVView` - список собеседований (HTML и CSV)
  - `InterviewDetailView` - детальная информация о собеседовании
  - `InterviewCommentUpsertView` - создание/обновление комментария к собеседованию
  - `InterviewResultsView` / `InterviewResultsDispatchView` - результаты собеседований
  - `InterviewAppointmentView` / `InterviewAppointmentAssignmentsView` - назначение собеседований

* **Зачисление:**
  - `ConfirmationOfAcceptanceForStudiesView` - подтверждение зачисления
  - `ConfirmationOfAcceptanceForStudiesDoneView` - страница успешного подтверждения зачисления

#### Команды управления:

* `stage2_register_in_yandex_exam_contest.py` - регистрация абитуриентов в контесте экзамена
* `stage2_test_validate_final_results.py` - валидация результатов тестирования

### Процесс приема:

1. **Подготовка кампании:**
   - Создание кампании с указанием сроков, проходных баллов и шаблонов писем
   - Настройка контестов в Yandex.Contest для тестирования, экзамена и олимпиады
   - Создание потоков собеседований с указанием дат, времени и интервьюеров

2. **Регистрация абитуриентов:**
   - Заполнение анкеты абитуриентом через веб-форму
   - Подтверждение электронной почты через код подтверждения
   - Проверка анкеты куратором и изменение статуса абитуриента

3. **Онлайн-тестирование:**
   - Регистрация абитуриентов в контесте тестирования
   - Прохождение онлайн-теста абитуриентами
   - Импорт результатов тестирования
   - Изменение статуса абитуриентов в зависимости от результатов (отклонение или допуск к следующему этапу)

4. **Олимпиада ШАД:**
   - Регистрация абитуриентов в контесте олимпиады
   - Прохождение олимпиады абитуриентами (программирование и математика)
   - Импорт результатов олимпиады
   - Изменение статуса абитуриентов в зависимости от результатов

5. **Экзамен:**
   - Регистрация абитуриентов в контесте экзамена
   - Прохождение экзамена абитуриентами
   - Импорт результатов экзамена
   - Изменение статуса абитуриентов в зависимости от результатов

6. **Собеседования:**
   - Создание приглашений на собеседование для абитуриентов, прошедших предыдущие этапы
   - Выбор абитуриентами удобного времени собеседования
   - Проведение собеседований интервьюерами
   - Оценка абитуриентов и добавление комментариев
   - Принятие решения о зачислении на основе результатов собеседования

7. **Зачисление:**
   - Создание подтверждений зачисления для принятых абитуриентов
   - Отправка уведомлений о зачислении
   - Подтверждение зачисления абитуриентами
   - Создание учетных записей студентов для зачисленных абитуриентов
   - Создание профилей студентов с указанием года поступления и типа профиля

## Интеграция с Yandex.Contest

Система тесно интегрирована с платформой Yandex.Contest для проведения онлайн-тестов, олимпиад и экзаменов. Интеграция реализована через API Yandex.Contest и включает следующие компоненты:

### API-клиент

* **YandexContestAPI** - класс для взаимодействия с API Yandex.Contest
  - Методы для получения информации о контестах
  - Методы для регистрации участников
  - Методы для получения результатов
  - Обработка ошибок API
  - Обновление токенов доступа

### Модели данных

* **Contest** - информация о контесте в Yandex.Contest
  - Связь с кампанией
  - Тип контеста (тест, экзамен, олимпиада)
  - Идентификатор контеста в Yandex.Contest
  - Настройки контеста

* **Test**, **Exam**, **Olympiad** - модели для хранения результатов различных типов испытаний
  - Связь с абитуриентом
  - Баллы за испытание
  - Идентификатор участника в контесте
  - Статус (новый, зарегистрирован, завершен)

### Команды управления

* **stage2_register_in_yandex_exam_contest.py** - команда для регистрации абитуриентов в контесте экзамена
  - Создание записей о экзамене для абитуриентов
  - Регистрация абитуриентов в контесте через API
  - Отправка уведомлений по электронной почте

* **stage2_test_validate_final_results.py** - команда для валидации результатов тестирования
  - Сравнение результатов в базе данных с результатами в контесте
  - Выявление расхождений и дубликатов
  - Диагностика проблем с данными

### Процесс работы с контестами

1. Создание контеста в Yandex.Contest
2. Настройка контеста в системе (связь с кампанией, тип контеста)
3. Регистрация абитуриентов в контесте через API
4. Проведение контеста на платформе Yandex.Contest
5. Импорт результатов в систему
6. Валидация результатов для выявления расхождений
7. Использование результатов для принятия решений о зачислении

*

2025-03-31 16:14:09 - Добавлена базовая информация о проекте, его целях, ключевых функциях и архитектуре.

2025-04-04 18:26:00 - Добавлена детальная информация о модуле приемной кампании (apps/admission), включая его основные компоненты, модели данных, представления, шаблоны, интеграцию с внешними сервисами и процесс приема абитуриентов.

2025-04-25 11:20:00 - Добавлена детальная информация о интеграции с Yandex.Contest, включая API-клиент, модели данных, команды управления и процесс работы с контестами.