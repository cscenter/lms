location /media/  {
    {% if media_root.endswith("/") -%}
        root {{ media_root[:-1] | dirname }};
    {% else -%}
        root {{ media_root | dirname }};
    {% endif -%}
    access_log off;
    tcp_nodelay off;
    # gzip_static on;
    gzip on;
    expires 6h;
    add_header Cache-Control public,max-age=21600;
    {% filter indent(width=4) %}
        {% include '_nginx.hsts.jinja2' %}
    {% endfilter %}

    location /media/assignments/ {
        internal;
    }
}

location /static/ {
    {% if static_root.endswith("/") -%}
        root {{ static_root[:-1] | dirname }};
    {% else -%}
        root {{ static_root | dirname }};
    {% endif -%}
    access_log off;
    tcp_nodelay off;
    gzip_static on;
    gzip on;
    gzip_min_length 1100;
    gzip_types text/css text/javascript application/javascript;
    expires 1M;
    add_header Cache-Control public,max-age=2592000;
    {% filter indent(width=4) %}
        {% include '_nginx.hsts.jinja2' %}
    {% endfilter %}
}

location ~ ^/apple-touch-icon(|-\d+x\d+)(|-precomposed).png {
    return 204;
    log_not_found off;
}
