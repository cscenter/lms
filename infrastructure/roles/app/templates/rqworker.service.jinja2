[Unit]
Description="Django redis queue worker"
After=network.target
Requires=redis.service postgresql.service
# Propagates restart/stop to this service if event occurred on the target unit
PartOf={{ rq_workers_target_service_name }}.target

[Service]
Type=simple
User={{ site_user }}
Group={{ site_user_group }}
KillSignal=SIGTERM
Restart=always
Environment=DJANGO_SETTINGS_MODULE={{ settings_module_parent_dir }}.settings.{{ app_environment }}
Environment=LANG=en_US.UTF-8
Environment=LC_ALL=en_US.UTF-8
Environment=LC_LANG=en_US.UTF-8
PrivateTmp=true
# Note that `manage.py` must be located in the root of the repo directory due to hardcoded python paths
ExecStart={{ virtualenv_root }}/bin/python {{ repo_root }}/manage.py rqworker {{ worker_name }} --pythonpath='{{ repo_root }}/{{ apps_dir_name }}'

[Install]
WantedBy=multi-user.target