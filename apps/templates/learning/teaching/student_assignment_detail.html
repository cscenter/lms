{% extends "base.html" %}
{% load i18n %}
{% load tz %}
{% load humanize %}
{% load crispy_forms_tags %}
{% load core_tags %}
{% load static %}
{% load render_bundle from webpack_loader %}

{% block title %}{{ a_s.student.get_short_name }} - {{ a_s.assignment.title }}{% endblock %}

{% block javascripts %}
    {#    TODO: append instead of replace #}
    <script type="text/javascript">
      CSC.config.localStorage.hashes = {{ hashes_json|safe }};
    </script>
    {% if is_actual_teacher or request.user.is_curator %}
        <script type="text/javascript">
        $('.assignment-attachment a:contains(".ipynb")').each(function() {
            if ( $(this).text().trim().match(".ipynb$") ) {
                $(this).clone()
                        .attr("href", this.href + "?html=1")
                        .attr("target", "_blank")
                        .text("[html]").insertAfter(this);
            }
        });
        </script>
    {% endif %}
    {% render_bundle 'learning' 'js' %}
{% endblock javascripts %}


{% block content %}
{% localtime off %}
<div class="container" id="student-submission-comments">
  <div class="row">
    <div class="col-xs-12 h2-and-buttons">
      <h2>
        <a href="{{ a_s.assignment.get_teacher_url }}"><span class="fa fa-angle-left"></span></a>
        {{ a_s.student.get_short_name }} <br>
        <small>{{ a_s.assignment.title }} (<a href="{{ a_s.assignment.course.get_absolute_url }}">{{ a_s.assignment.course }}</a>)</small>
      </h2>
      {% if user.is_curator or is_actual_teacher %}
      <div class="btn-toolbar">
        <a href="{{ a_s.assignment.get_update_url }}" class="btn btn-primary" role="button">{% trans "Edit" %}</a>
      </div>
      {% endif %}
      <hr>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-9">
        {% include "learning/_student_assignment_left_column.html" %}
    </div>

        <div class="col-xs-3">
            <div class="-submission" id="o-sidebar">
                {% if is_actual_teacher and next_student_assignment %}
                  <a href="{% url 'teaching:student_assignment_detail' next_student_assignment.pk %}" class="btn btn-default">
                    {% trans "Next unchecked[assignment]" %} <i class="fa fa-angle-right"></i>
                  </a>
                {% endif %}

                <h5 class="assignment">{% trans "Grade" %}</h5>
                {% if is_actual_teacher %}
                {% crispy score_form %}
                {% else %}
                <span class="nowrap badge assignment-status {{ a_s.state.css_class }}">{{ a_s.state_display }}</span>
                {% endif %}

                {% if not is_actual_teacher %}
                      {% if one_teacher %}
                      <h5 class="assignment">{% trans "Professor" %}</h5>
                      {% else %}
                      <h5 class="assignment">{% trans "Professors" %}</h5>
                      {% endif %}
                      <ul class="list-unstyled">
                        {% for teacher in a_s.assignment.course.teachers.all %}
                        <li>
                          <a href="{{ teacher.teacher_profile_url }}">{{ teacher.get_full_name }}</a>
                        </li>
                        {% endfor %}
                      </ul>
                {% endif %}
                <h5 class="assignment">{% if a_s.student.is_volunteer %}{% trans "Volunteer" %}{% else %}{% trans "Student" %}{% endif %}</h5>
                <a href="{{ a_s.student.get_absolute_url }}">{{ a_s.student.get_full_name }}</a>

                <h5 class="assignment">{% trans "Deadline" %}</h5>
                <span class="nowrap">{{ a_s.assignment.deadline_at|timezone:timezone|naturalday:"d E Y" }} {{ a_s.assignment.deadline_at|timezone:timezone|time:"H:i" }}</span>

                <h5 class="assignment">{% trans "Maximum score" %}</h5>
                <span class="nowrap">{{ a_s.assignment.maximum_score }}</span>

                <h5 class="assignment">{% trans "Passing score" %}</h5>
                <span class="nowrap">{{ a_s.assignment.passing_score }}</span>

                <h5 class="assignment">{% trans "Assignment created" %}</h5>
                {{ a_s.assignment.created_local|date:"d E Y" }}
                {% if a_s.assignment.is_online %}
                <h4>{% trans "Can be passed online "%}</h4>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{#  XXX: Due to bug with `fade` class and `shown.bs.modal` event put this html code here  #}
    <div id='submission-comment-model-form' class='modal' tabindex='-1' role='dialog'>
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Редактировать комментарий</h4>
                    <p class="text-muted">Пожалуйста, не меняйте смысл комментария, т.к. студент потенциально мог его прочитать в текущей версии и начать отвечать.<br>В таком случае лучше написать новый.</p>
                </div>
                <div class="inner"></div>
            </div>
        </div>
    </div>
{% endlocaltime off %}
{% endblock content %}
