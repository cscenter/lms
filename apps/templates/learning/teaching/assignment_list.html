{% extends "base.html" %}
{% load i18n %}
{% load tz %}
{% load humanize %}
{% load core_tags %}
{% load static %}
{% load render_bundle from webpack_loader %}

{% block body_attrs %} class="gray" data-init-sections="submissions"{% endblock body_attrs %}

{% block javascripts %}
    {% render_bundle 'teaching' 'js' 'V1' %}
{% endblock javascripts %}

{% block content %}
{% localtime off %}
<div class="container" id="assignments-page">
<div class="row">

<div class="col-xs-3">
    <h5>ПОКАЗАТЬ</h5>
    <div class="list-group inverse">
      {% for code, name in filter_by_score %}
          {% call_function 'set_query_parameter' base_url 'score' code as filter_url %}
          <a href="{{ filter_url }}" class="list-group-item{% if code == query.score %} active{% endif %}">{{ name }}</a>
      {% endfor %}
    </div>

    <h5>ПОСЛЕДНИЙ КОММЕНТАРИЙ</h5>
    <div class="list-group inverse">
      {% for code, comment in filter_by_comments %}
          {% call_function 'set_query_parameter' base_url 'comment' code as filter_url %}
          <a href="{{ filter_url}}" class="list-group-item{% if code == query.comment %} active{% endif %}">{{ comment|safe }}</a>
      {% endfor %}
    </div>

    <h5>ГРУППА</h5>
    <div class="list-group inverse">
      {% for code, name in filter_by_student_group %}
          {% call_function 'set_query_parameter' base_url 'student_group' code as filter_url %}
          <a href="{{ filter_url }}" class="list-group-item{% if code == query.student_group %} active{% endif %}">{{ name }}</a>
      {% endfor %}
    </div>

    {% if course_offerings %}
        <h5>КУРС</h5>
        <div class="list-group inverse">
          {% for course in course_offerings %}
                <a href="{% url "teaching:assignment_list" %}?term={{ course.semester.slug }}&course={{ course.meta_course.slug }}" data-slug="{{ course.meta_course.slug }}" class="list-group-item{% if course.meta_course.slug == query.course %} active{% endif %}" title="{{ course.meta_course.name }}">{{ course.meta_course.name }}</a>
          {% endfor %}
        </div>
    {% endif %}

    {% if all_terms %}
        <h5>СЕМЕСТР</h5>
        <div class="list-group inverse">
          {% for term in all_terms %}
              <a href="{% url "teaching:assignment_list" %}?term={{ term.slug }}" class="list-group-item{% if term.slug == query.term %} active{% endif %}">{{ term }}</a>
          {% endfor %}
        </div>
    {% endif %}
</div>

<div class="col-xs-9">
    {% if assignments %}
        <div class="filters">
            <form action="{{ form_url }}" method="GET">
                <input type="hidden" name="assignments" value="" />
                <select id="assignments-select">
                    {% for assignment in assignments %}
                        <option {% if assignment.pk == query.assignment %}selected{% endif %} value="{{ assignment.pk }}">{{ assignment.title }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="btn btn-primary" id="assignments-select-button">Показать</button>
                <div class="loading"><i class="fa fa-spinner fa-pulse"></i></div>
            </form>
        </div>
    {% endif %}
    <ol class="breadcrumb gray">
        <li class="active">Выполнение заданий</li>
    </ol>
    <div class="clearfix"></div>

    {% if query.assignment %}
    <div class="panel">
        <div class="panel-body">
          {% call_method assignment "deadline_at_local" tz_override as assignment_deadline_at_local %}
            <b>{% trans "Deadline" %}</b>: <span class="assignment-date {{ assignment_deadline_at_local|date_soon_css }}">{{ assignment_deadline_at_local|naturalday:"d E" }} {{ assignment_deadline_at_local|time:"H:i" }}</span>
            <div class="pull-right"><a href="{{ assignment.get_teacher_url }}">Страница задания</a></div>
        </div>
    </div>
    {% endif %}

    <div class="assignments-inner">
    {% if query.assignment and student_assignment_list %}
      <table class="table" width="100%">
        <thead>
        <tr>
            <th >{% trans "Student" %}</th>
            <th width="10%">{% trans "Grade" %}</th>
        </tr>
        </thead>
        {% for s_a in student_assignment_list %}
            <tr class="{{ s_a.has_unread|yesno:"unread,noop" }}">
                <td>
                    <a{% if s_a.student_id not in enrollments %} style="text-decoration: line-through;"{% endif %} href="{{ s_a.get_teacher_url }}">{{ s_a.student.get_short_name }}</a>
                    {% if s_a.student_id not in enrollments %}<span class="text-muted">покинул{% if s_a.student.gender == 'F' %}а{% endif %} курс</span>{% endif %}
{#                    {% if not s_a.has_unread %}<a href="#" style="color:#777;" class="mark-as-unread pull-right"><i class="fa fa-eye-slash" aria-hidden="true"></i></a>{% endif %}#}
                </td>
                <td>
                    <span class="assignment-status {{ s_a.state.css_class }}">{{ s_a.state_short }}</span>
                </td>
            </tr>
        {% endfor %}
      </table>
    {% elif assignments %}
        <div style="padding: 5px;">Задайте другие критерии поиска.</div>
    {% else %}
        <div style="padding: 5px;">Занятия, на которые вы подписаны, не найдены.</div>
    {% endif %}
    </div>
</div>

</div>
</div>
{% endlocaltime %}
{% endblock content %}
