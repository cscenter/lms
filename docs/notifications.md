# Нотификации

Уведомления отправляются только по email, отправка по cron с задержкой 5 минут. 
Тело сообщения генерируется в момент отправки. Для части сообщений используется Atom Syndication Format (как на github). 
Физически уведомления хранятся в разных таблицах БД, у каждой свой формат.
Непрочитанные уведомления удаляются в ручном режиме, срок хранения обычно не превышает семестр, если поточнее, то до первой жалобы "не могу сбросить счетчик уведомления".
Прочитанные уведомления удаляются по крону раз в неделю.

Почти все нотификации принудительные, пользователь самостоятельно настроить необходимые ему события не может.

Куратор может повлиять только на уведомления преподавателя о новых комментариях к заданию. 

Схема работы следующая:

У каждого **задания** есть настройки уведомлений, где указывается список пользователей, которые будут получать нотификации о новых комментариях.
В настройках **прочтения курса** при добавлении преподавателя можно установить чекбокс "Автоматически подписывать на уведомления".
Тогда в момент создания задания (и только тогда) все преподаватели, у кого установлен этот чекбокс, будут скопированы в настройки уведомлений нового задания.
Если преподаватель был добавлен после создания задания и хочет получать уведомления, его нужно добавить в настройки уведомлений уже вручную.

Неочевидный момент: Если преподаватель не подписан на уведомления о задании, то он не увидит его на странице заданий.


## События

#### Новость о курсе

Отправляется всем студентам, подписанным на курс, а также всем преподавателям курса.

#### Новое задание

Уведомление получат только студенты, подписанные на курс.

#### Изменение дедлайна задания

Уведомление получат только студенты, подписанные на курс.

#### Новый комментарий к заданию

Если комментарий оставил студент, то все преподаватели, кто подписан на уведомления, получат уведомление.

Если комментарий от преподавателя, то уведомление ожидаемо получит только студент.

#### Начало отчетного периода по сдаче проектов

За 3 дня до начала отчетного периода, студенты, чей проект не был отменен и кто не успел получить отрицательный балл, получат уведомление.
Повторное напоминание о том, что скоро наступит дедлайн записи, будет отправлено за 1 день до окончания.

#### Отправлен новый отчет по проекту

Уведомление получат все пользователи, у которых выставлена группа `Куратор проектов`

#### Новый комментарий к отчету по проекту

Уведомление получают 3 группы: автор отчета (он же студент), кураторы проектов и проверяющие, подписанные на связанный с отчетом проект.

Кураторы проектов и студент всегда получают уведомления о новых комментариях. 

Проверяющие получают уведомления о новых комментариях только если текущий статус отчета - "Проверка".

#### Добавлен опрос к курсу

Уведомление генерируется в момент публикации опроса (должен быть выставлен соответствующий статус), получатели - только студенты, подписанные на курс. 
