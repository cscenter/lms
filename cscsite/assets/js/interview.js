!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=function(){function b(){var b=this,c=function(){var c=[b.options.wrapperClass];""!==b.options.theme&&c.push("br-theme-"+b.options.theme),b.$elem.wrap(a("<div />",{"class":c.join(" ")}))},d=function(){b.$elem.unwrap()},e=function(){var c;return c=b.options.initialRating?a('option[value="'+b.options.initialRating+'"]',b.$elem):a("option:selected",b.$elem)},f=function(a){var c=b.$elem.data("barrating");return"undefined"!=typeof a?c[a]:c},g=function(a,c){null!==c&&"object"==typeof c?b.$elem.data("barrating",c):b.$elem.data("barrating")[a]=c},h=function(){var a=e();g(null,{userOptions:b.options,ratingValue:a.val(),ratingText:a.data("html")?a.data("html"):a.text(),originalRatingValue:a.val(),originalRatingText:a.data("html")?a.data("html"):a.text(),readOnly:b.options.readonly,deselectable:!b.$elem.find("option:first").val()})},i=function(){b.$elem.removeData("barrating")},j=function(){return f("ratingText")},k=function(){return f("ratingValue")},l=function(){var c=a("<div />",{"class":"br-widget"});return b.$elem.find("option").each(function(){var d,e,f,g;d=a(this).val(),d&&(e=a(this).text(),f=a(this).data("html"),f&&(e=f),g=a("<a />",{href:"#","data-rating-value":d,"data-rating-text":e,html:b.options.showValues?e:""}),c.append(g))}),b.options.showSelectedRating&&c.append(a("<div />",{text:"","class":"br-current-rating"})),b.options.reverse&&c.addClass("br-reverse"),b.options.readonly&&c.addClass("br-readonly"),c},m=function(){return f("userOptions").reverse?"nextAll":"prevAll"},n=function(a){b.$elem.find('option[value="'+a+'"]').prop("selected",!0),b.$elem.change()},o=function(a){a=a?a:j(),b.options.showSelectedRating&&b.$elem.parent().find(".br-current-rating").text(a)},p=function(){b.$widget.find("a").removeClass("br-selected br-current"),b.$widget.find('a[data-rating-value="'+k()+'"]').addClass("br-selected br-current")[m()]().addClass("br-selected")},q=function(a){return a.hasClass("br-current")&&f("deselectable")},r=function(c){c.on("click.barrating",function(d){var e,h,i=a(this),l=f("userOptions");return d.preventDefault(),c.removeClass("br-active br-selected"),i.addClass("br-selected")[m()]().addClass("br-selected"),e=i.attr("data-rating-value"),h=i.attr("data-rating-text"),q(i)?(i.removeClass("br-selected br-current")[m()]().removeClass("br-selected br-current"),e="",h=""):(c.removeClass("br-current"),i.addClass("br-current")),g("ratingValue",e),g("ratingText",h),n(e),o(h),l.onSelect.call(b,k(),j(),d),!1})},s=function(b){b.on("mouseenter.barrating focus.barrating",function(){var c=a(this);b.removeClass("br-active br-selected"),c.addClass("br-active")[m()]().addClass("br-active"),o(c.attr("data-rating-text"))})},t=function(a){b.$widget.on("mouseleave.barrating blur.barrating",function(){a.removeClass("br-active"),o(),p()})},u=function(b){b.on("touchstart.barrating",function(b){b.preventDefault(),b.stopPropagation(),a(this).click()})},v=function(a){a.on("click.barrating",function(a){a.preventDefault()})},w=function(a){r(a),b.options.hoverState&&(s(a),t(a))},x=function(a){a.off(".barrating")},y=function(a){$elements=b.$widget.find("a"),u&&u($elements),a?(x($elements),v($elements)):w($elements)};this.show=function(){f()||(c(),h(),b.$widget=l(),b.$widget.insertAfter(b.$elem),p(),o(),y(b.options.readonly),b.$elem.hide())},this.readonly=function(a){"boolean"==typeof a&&f("readOnly")!=a&&(y(a),g("readOnly",a),b.$widget.toggleClass("br-readonly"))},this.set=function(a){var c=f("userOptions");b.$elem.find('option[value="'+a+'"]').val()&&(g("ratingValue",a),g("ratingText",b.$elem.find('option[value="'+a+'"]').text()),n(k()),o(j()),p(),c.silent||c.onSelect.call(this,k(),j()))},this.clear=function(){var a=f("userOptions");g("ratingValue",f("originalRatingValue")),g("ratingText",f("originalRatingText")),n(k()),o(j()),p(),a.onClear.call(this,k(),j())},this.destroy=function(){var a=k(),c=j(),e=f("userOptions");x(b.$widget.find("a")),b.$widget.remove(),i(),d(),b.$elem.show(),e.onDestroy.call(this,a,c)}}return b.prototype.init=function(b,c){return this.$elem=a(c),this.options=a.extend({},a.fn.barrating.defaults,b),this.options},b}();a.fn.barrating=function(c,d){return this.each(function(){var e=new b;if(a(this).is("select")||a.error("Sorry, this plugin only works with select fields."),e.hasOwnProperty(c)){if(e.init(d,this),"show"===c)return e.show(d);if(e.$elem.data("barrating"))return e.$widget=a(this).next(".br-widget"),e[c](d)}else{if("object"==typeof c||!c)return d=c,e.init(d,this),e.show();a.error("Method "+c+" does not exist on jQuery.barrating")}})},a.fn.barrating.defaults={theme:"",initialRating:null,showValues:!1,showSelectedRating:!0,reverse:!1,readonly:!1,fastClicks:!0,hoverState:!0,silent:!1,wrapperClass:"br-wrapper",onSelect:function(a,b,c){},onClear:function(a,b){},onDestroy:function(a,b){}},a.fn.barrating.BarRating=b}),function(a){"use strict";var b=a("select#id_score"),c=a("#comment form"),d=(a("textarea[name=text]",c),{launch:function(){d.initRatingBar(),d.submitFormHandler();var b=window.location.hash;b&&a('ul.nav a[href="'+b+'"]').tab("show"),a(".nav-tabs a").click(function(b){a(this).tab("show");var c=a("body").scrollTop()||a("html").scrollTop();a("html,body").scrollTop(c)})},initRatingBar:function(){b.barrating({theme:"bars-movie",hoverState:!1})},submitFormHandler:function(){c.submit(function(b){b.preventDefault();var d=c.serializeArray(),e={};a.map(d,function(a,b){e[a.name]=a.value}),a.ajax({url:c.attr("action"),data:JSON.stringify(e),dataType:"json",type:"POST"}).done(function(a){"true"==a.success?swal({title:"Данные сохранены",text:"Страница будет перезагружена\nTODO: перезагрузка будет убрана в ближайшее время!",type:"success"},function(){window.location.reload()}):swal({title:"Ошибка валидации",text:"Укажите оценку перед сохранением.",type:"warning",confirmButtonText:"Хорошо"})}).fail(function(a){swal({title:"Всё плохо!",text:"Пожалуйста, скопируйте результаты своей работы и попробуйте перезагрузить страницу.",type:"error"})})})}});a(document).ready(function(){d.launch()})}(jQuery);