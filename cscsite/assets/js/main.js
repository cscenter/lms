"use strict";function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}var ends_at_touched=!1;$(document).ready(function(){var a=$.cookie("csrftoken");$.ajaxSetup({beforeSend:function(b,c){csrfSafeMethod(c.type)||this.crossDomain||b.setRequestHeader("X-CSRFToken",a)}});var b=window.CSCCommentPersistenceHashes;hljs.configure({tabReplace:"    "}),$("div.ubertext").each(function(a,b){MathJax.Hub.Queue(["Typeset",MathJax.Hub,b,function(){var a=$(b);a.find("pre").addClass("hljs").find("code").each(function(a,b){var c=b.innerHTML;b.innerHTML=_.escape(_.unescape(_.unescape(c))),hljs.highlightBlock(b)})}])});var c=$("textarea.ubereditor");c.length>1&&console.warn("more than one Ubereditor on page, text restoration may be buggy"),c.length>0&&window.hasOwnProperty("localStorage")&&!function(){var a=new EpicEditor,c=a.getFiles(null,!0);_.each(c,function(c,d,e){var f=(new Date-new Date(c.modified))/36e5;if(f>24)a.remove(d);else if(b){var g=a.exportFile(d).replace(/\s+/g,""),h=CryptoJS.MD5(g).toString();h in b&&a.remove(d)}})}();var d=[];if(c.each(function(a,b){var c=$(b),e=$("<div/>").insertAfter(c),f=!1,g=1==c.data("local-persist");c.hide(),f=c.prop("autofocus"),c.removeProp("required");var h={container:e[0],textarea:c[0],parser:null,focusOnLoad:f,basePath:"/static/js/vendor/EpicEditor-v0.2.2",clientSideStorage:g,autogrow:{minHeight:200},button:{bar:"show"},theme:{base:"/themes/base/epiceditor.css",editor:"/themes/editor/epic-light.css"}},i=window.location.pathname.replace(/\//g,"_")+"_"+a.toString();g&&(h.file={name:i,defaultContent:"",autoSave:300});var j=new EpicEditor(h);j.load();var k=j.getElement("previewer"),l=k.createElement("script");if(l.type="text/javascript",l.src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML",k.body.appendChild(l),k.body.appendChild($("[type^='text/x-mathjax-config']").clone().get(0)),j.on("preview",function(){var a=j.getElement("previewerIframe").contentDocument,b=$("#epiceditor-preview",a).get(0),c=_.unescape(b.innerHTML);c.length>0&&$.ajax({method:"POST",url:"/tools/markdown/preview/",traditional:!0,data:{text:c},dataType:"json"}).done(function(a){"OK"==a.status&&($(b).html(a.text),MathJax.Hub.Queue(["Typeset",MathJax.Hub,b,function(){if($(b).find("pre").addClass("hljs"),!j.is("fullscreen")){var a=Math.max($(b).height()+20,j.settings.autogrow.minHeight);e.height(a)}j.reflow()}]))}).error(function(a){var b;b=403==a.status?"Action forbidden":"Unknown error. Please, save results of your work first, then try to reload page.",swal({title:"Error",text:b,type:"error"})})}),j.on("fullscreenenter",function(){void 0!==yaCounter25844420&&yaCounter25844420.reachGoal("MARKDOWN_PREVIEW_FULLSCREEN")}),j.on("edit",function(){if(!j.is("fullscreen")){var a=Math.max($(j.getElement("editor").body).height()+20,j.settings.autogrow.minHeight);e.height(a)}j.reflow()}),"true"==c[0].dataset.quicksend){var m=j.getElement("editor").body;m.addEventListener("keydown",function(a){13==a.keyCode&&(a.metaKey||a.ctrlKey)&&c[0].form.submit()})}d.push(j)}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$($(a.target).attr("href")),c=b.find("iframe[id^=epiceditor-]"),e=[];c.each(function(a,b){e.push($(b).attr("id"))}),$(d).each(function(a,b){-1!==$.inArray(b._instanceId,e)&&b.reflow()})}),$("#id_ends_at").focus(function(){ends_at_touched=!0}),$("#id_starts_at").change(function(){function a(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}var b=80;if(!ends_at_touched){var c=$(this).val(),d=c.match("([0-9]{2})([:-])([0-9]{2})([:0-9-]*)");if(null!==d){var e=parseInt(d[1]),f=d[2],g=parseInt(d[3]),h=d[4],i=g+b,j=(e+Math.floor(i/60))%24,k=i%60;$("#id_ends_at").val(a(j,2)+f+a(k,2)+h)}else console.warning("Can't parse "+c)}}),function(){var a=$("div.assignment-list-control"),b=$("#assignments-table .old");a.on("click",".current-semester",function(c){var d=$(c.target);a.find(".all").removeClass("active"),d.addClass("active"),b.hide()}).on("click",".all",function(c){var d=$(c.target);a.find(".current-semester").removeClass("active"),d.addClass("active"),b.show()})}(),$(".user-search").length>0){var e={},f={},g={},h="",i={},j=$(".user-search #ajax-uri").val(),k=function(){var a,b,c,d;a=_.chain(e).pairs().filter(function(a){return a[1]}).map(function(a){return a[0]}).value().join(","),c=_.chain(g).pairs().filter(function(a){return a[1]}).map(function(a){return a[0]}).value().join(","),d=_.chain(i).pairs().filter(function(a){return a[1]}).map(function(a){return a[0]}).value().join(","),b=_.chain(f).pairs().filter(function(a){return a[1]}).map(function(a){return a[0]}).value(),$.ajax({url:j,data:{name:h,enrollment_year:a,groups:b,status:c,cnt_enrollments:d},dataType:"json",traditional:!0}).done(function(a){var b=a.users.length.toString()+(a.there_is_more?"+":"");$("#user-num-container").show(),$("#user-num").text(b);var c='<table class="table table-condensed">';_.each(a.users,function(a){c+='<tr><td><a href="'+a.url+'">',c+=a.last_name+" "+a.first_name,c+="</a></td></tr>"}),a.there_is_more&&(c+="<tr><td>â€¦</td></tr>"),c+="</table>",$("#user-table-container").html(c)})};k=_.debounce(k,200),$('.user-search [name="enrollment_year_cb"]').each(function(a,b){e[$(b).val()]=!1}),$(".user-search").on("input paste","#name",function(a){h=$(this).val(),k()}).on("change",'[name="enrollment_year_cb"]',function(a){e[$(this).val()]=this.checked,k()}).on("change",'[name="group"]',function(a){f[$(this).val()]=this.checked,k()}).on("change",'[name="status"]',function(a){g[$(this).val()]=this.checked,k()}).on("change",'[name="cnt_enrollments"]',function(a){i[$(this).val()]=this.checked,k()})}$(".forms-iframe").length>0&&($(window).on("message",function(a){var b=a.originalEvent,c=b.data,d=b.source;try{c=JSON.parse(c)}catch(a){}("ping"===c||"ping"===c.message)&&d.postMessage("pong","*")}),$(window).on("message",function(a){var b=a.originalEvent,c=b.data;try{c=JSON.parse(c)}catch(a){}c&&c["iframe-height"]&&$(".forms-iframe").css("height",c["iframe-height"])}))});