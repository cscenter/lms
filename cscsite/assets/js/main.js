function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}!function(a){"use strict";var b=!1,c=window.CSCCommentPersistenceHashes,d=a("textarea.ubereditor");d.length>1&&console.warn("more than one Ubereditor on page, text restoration may be buggy");var e=a("div.ubertext"),f=[],g="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";a(document).ready(function(){h.configureCSRFAjax(),h.loadMathJaxAndHightlightJS(),h.initUberEditor(),h.profileSpecificCode(),h.courseClassSpecificCode(),h.admissionFormSpecificCode(),h.reflowEditorOnTabToggle(),h.clearEditorsFiles()});var h={configureCSRFAjax:function(){var b=a.cookie("csrftoken");a.ajaxSetup({beforeSend:function(a,c){csrfSafeMethod(c.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",b)}})},loadMathJaxAndHightlightJS:function(){if(e.length>0){var b=[g,HIGHLIGHTJS_SRC],c=a.Deferred(),d=c;a.each(b,function(b,c){d=d.then(function(){return a.ajax({url:c,dataType:"script",cache:!0})})}),d.done(function(){h.configureHighlightJS(),h.initMathJaxAndHightlightJS()}),c.resolve()}},configureHighlightJS:function(){hljs.configure({tabReplace:"    "})},initMathJaxAndHightlightJS:function(){e.each(function(b,c){MathJax.Hub.Queue(["Typeset",MathJax.Hub,c,function(){var b=a(c);b.find("pre").addClass("hljs").find("code").each(function(a,b){var c=b.innerHTML;b.innerHTML=_.escape(_.unescape(_.unescape(c))),hljs.highlightBlock(b)})}])})},initUberEditor:function(){d.each(function(b,c){var d=a(c),e=a("<div/>").insertAfter(d),g=!1,h=1==d.data("local-persist");d.hide(),g=d.prop("autofocus"),d.removeProp("required");var i={container:e[0],textarea:d[0],parser:null,focusOnLoad:g,basePath:"/static/js/vendor/EpicEditor-v0.2.2",clientSideStorage:h,autogrow:{minHeight:200},button:{bar:"show"},theme:{base:"/themes/base/epiceditor.css",editor:"/themes/editor/epic-light.css"}},j=window.location.pathname.replace(/\//g,"_")+"_"+b.toString();h&&(i.file={name:j,defaultContent:"",autoSave:300});var k=new EpicEditor(i);k.load();var l=k.getElement("previewer"),m=l.createElement("script");if(m.type="text/javascript",m.src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML",l.head.appendChild(a("script[type^='text/x-mathjax-config']").clone().get(0)),l.body.appendChild(m),k.on("preview",function(){var b=k.getElement("previewerIframe").contentDocument,c=a("#epiceditor-preview",b).get(0),d=_.unescape(c.innerHTML);d.length>0&&a.ajax({method:"POST",url:"/tools/markdown/preview/",traditional:!0,data:{text:d},dataType:"json"}).done(function(b){"OK"==b.status&&(c.innerHTML=b.text,k.getElement("previewerIframe").contentWindow.MathJax.Hub.Queue(function(){k.getElement("previewerIframe").contentWindow.MathJax.Hub.Typeset(c,function(){if(a(c).find("pre").addClass("hljs"),!k.is("fullscreen")){var b=Math.max(a(c).height()+20,k.settings.autogrow.minHeight);e.height(b)}k.reflow()})}))}).error(function(a){var b;b=403==a.status?"Action forbidden":"Unknown error. Please, save results of your work first, then try to reload page.",swal({title:"Error",text:b,type:"error"})})}),k.on("fullscreenenter",function(){void 0!==yaCounter25844420&&yaCounter25844420.reachGoal("MARKDOWN_PREVIEW_FULLSCREEN")}),k.on("edit",function(){if(!k.is("fullscreen")){var b=Math.max(a(k.getElement("editor").body).height()+20,k.settings.autogrow.minHeight);e.height(b)}k.reflow()}),"true"==d[0].dataset.quicksend){var n=k.getElement("editor").body;n.addEventListener("keydown",function(a){13==a.keyCode&&(a.metaKey||a.ctrlKey)&&d[0].form.submit()})}f.push(k)})},clearEditorsFiles:function(){if(d.length>0&&window.hasOwnProperty("localStorage")){var a=new EpicEditor,b=a.getFiles(null,!0);_.each(b,function(b,d,e){var f=(new Date-new Date(b.modified))/36e5;if(f>24)a.remove(d);else if(c){var g=a.exportFile(d).replace(/\s+/g,""),h=CryptoJS.MD5(g).toString();h in c&&a.remove(d)}})}},profileSpecificCode:function(){!function(){var b=a("div.assignment-list-control"),c=a("#assignments-table .old");b.on("click",".current-semester",function(d){var e=a(d.target);b.find(".all").removeClass("active"),e.addClass("active"),c.hide()}).on("click",".all",function(d){var e=a(d.target);b.find(".current-semester").removeClass("active"),e.addClass("active"),c.show()})}()},courseClassSpecificCode:function(){a("#id_ends_at").focus(function(){b=!0}),a("#id_starts_at").change(function(){function c(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}var d=80;if(!b){var e=a(this).val(),f=e.match("([0-9]{2})([:-])([0-9]{2})([:0-9-]*)");if(null!==f){var g=parseInt(f[1]),h=f[2],i=parseInt(f[3]),j=f[4],k=i+d,l=(g+Math.floor(k/60))%24,m=k%60;a("#id_ends_at").val(c(l,2)+h+c(m,2)+j)}else console.warning("Can't parse "+e)}})},admissionFormSpecificCode:function(){a(".forms-iframe").length>0&&(a(window).on("message",function(a){var b=a.originalEvent,c=b.data,d=b.source;try{c=JSON.parse(c)}catch(a){}("ping"===c||"ping"===c.message)&&d.postMessage("pong","*")}),a(window).on("message",function(b){var c=b.originalEvent,d=c.data;try{d=JSON.parse(d)}catch(b){}d&&d["iframe-height"]&&a(".forms-iframe").css("height",d["iframe-height"])}))},reflowEditorOnTabToggle:function(){a('a[data-toggle="tab"]').on("shown.bs.tab",function(b){var c=a(a(b.target).attr("href")),d=c.find("iframe[id^=epiceditor-]"),e=[];d.each(function(b,c){e.push(a(c).attr("id"))}),a(f).each(function(b,c){-1!==a.inArray(c._instanceId,e)&&c.reflow()})})}}}(jQuery,HIGHLIGHTJS_SRC);