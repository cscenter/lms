function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}!function(a,b,c){"use strict";var d=!1,e=window.CSCCommentPersistenceHashes,f=a("textarea.ubereditor"),g=a("div.ubertext"),h=[],i="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";a(document).ready(function(){j.configureCSRFAjax(),j.loadMathJaxAndHightlightJS(),j.initUberEditor(),j.profileSpecificCode(),j.courseClassSpecificCode(),j.admissionFormSpecificCode(),j.reflowEditorOnTabToggle(),j.clearEditorsFiles()});var j={configureCSRFAjax:function(){var b=a.cookie("csrftoken");a.ajaxSetup({beforeSend:function(a,c){csrfSafeMethod(c.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",b)}})},loadMathJaxAndHightlightJS:function(){if(g.length>0){var c=[i,b],d=a.Deferred(),e=d;a.each(c,function(b,c){e=e.then(function(){return a.ajax({url:c,dataType:"script",cache:!0})})}),e.done(function(){j.initMathJaxAndHightlightJS()}),d.resolve()}},initMathJaxAndHightlightJS:function(){hljs.configure({tabReplace:"    "}),g.each(function(b,d){MathJax.Hub.Queue(["Typeset",MathJax.Hub,d,function(){var b=a(d);b.find("pre").addClass("hljs").find("code").each(function(a,b){var d=b.innerHTML;b.innerHTML=c.escape(c.unescape(c.unescape(d))),hljs.highlightBlock(b)})}])})},initUberEditor:function(){f.each(function(b,d){var e=a(d),f=a("<div/>").insertAfter(e),g=1==e.data("local-persist");e.hide(),e.removeProp("required");var i=e.prop("autofocus"),j={container:f[0],textarea:e[0],parser:null,focusOnLoad:i,basePath:"/static/js/vendor/EpicEditor-v0.2.2",clientSideStorage:g,autogrow:{minHeight:200},button:{bar:"show"},theme:{base:"/themes/base/epiceditor.css",editor:"/themes/editor/epic-light.css"}};if(g){void 0===d.name&&console.error("Missing attr `name` for textarea. Text restore will be buggy.");var k=window.location.pathname.replace(/\//g,"_")+"_"+d.name;j.file={name:k,defaultContent:"",autoSave:200}}var l=new EpicEditor(j);l.load();var m=l.getElement("previewer"),n=m.createElement("script");if(n.type="text/javascript",n.src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML",m.head.appendChild(a("script[type^='text/x-mathjax-config']").clone().get(0)),m.body.appendChild(n),l.on("preview",function(){var b=l.getElement("previewerIframe").contentDocument,d=a("#epiceditor-preview",b).get(0),e=c.unescape(d.innerHTML);e.length>0&&a.ajax({method:"POST",url:"/tools/markdown/preview/",traditional:!0,data:{text:e},dataType:"json"}).done(function(b){"OK"==b.status&&(d.innerHTML=b.text,l.getElement("previewerIframe").contentWindow.MathJax.Hub.Queue(function(){l.getElement("previewerIframe").contentWindow.MathJax.Hub.Typeset(d,function(){if(a(d).find("pre").addClass("hljs"),!l.is("fullscreen")){var b=Math.max(a(d).height()+20,l.settings.autogrow.minHeight);f.height(b)}l.reflow()})}))}).error(function(a){var b;b=403==a.status?"Action forbidden":"Unknown error. Please, save results of your work first, then try to reload page.",swal({title:"Error",text:b,type:"error"})})}),l.on("fullscreenenter",function(){void 0!==yaCounter25844420&&yaCounter25844420.reachGoal("MARKDOWN_PREVIEW_FULLSCREEN")}),l.on("edit",function(){if(!l.is("fullscreen")){var b=Math.max(a(l.getElement("editor").body).height()+20,l.settings.autogrow.minHeight);f.height(b)}l.reflow()}),"true"==e[0].dataset.quicksend){var o=l.getElement("editor").body;o.addEventListener("keydown",function(a){13==a.keyCode&&(a.metaKey||a.ctrlKey)&&e[0].form.submit()})}h.push(l)})},clearEditorsFiles:function(){if(f.length>0&&window.hasOwnProperty("localStorage")){var a=new EpicEditor,b=a.getFiles(null,!0);c.each(b,function(b,c,d){var f=(new Date-new Date(b.modified))/36e5;if(f>24)a.remove(c);else if(e){var g=a.exportFile(c).replace(/\s+/g,""),h=CryptoJS.MD5(g).toString();h in e&&a.remove(c)}})}},profileSpecificCode:function(){!function(){var b=a("div.assignment-list-control"),c=a("#assignments-table .old");b.on("click",".current-semester",function(d){var e=a(d.target);b.find(".all").removeClass("active"),e.addClass("active"),c.hide()}).on("click",".all",function(d){var e=a(d.target);b.find(".current-semester").removeClass("active"),e.addClass("active"),c.show()})}()},courseClassSpecificCode:function(){a("#id_ends_at").focus(function(){d=!0}),a("#id_starts_at").change(function(){function b(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}var c=80;if(!d){var e=a(this).val(),f=e.match("([0-9]{2})([:-])([0-9]{2})([:0-9-]*)");if(null!==f){var g=parseInt(f[1]),h=f[2],i=parseInt(f[3]),j=f[4],k=i+c,l=(g+Math.floor(k/60))%24,m=k%60;a("#id_ends_at").val(b(l,2)+h+b(m,2)+j)}else console.warning("Can't parse "+e)}})},admissionFormSpecificCode:function(){a(".forms-iframe").length>0&&(a(window).on("message",function(a){var b=a.originalEvent,c=b.data,d=b.source;try{c=JSON.parse(c)}catch(a){}("ping"===c||"ping"===c.message)&&d.postMessage("pong","*")}),a(window).on("message",function(b){var c=b.originalEvent,d=c.data;try{d=JSON.parse(d)}catch(b){}d&&d["iframe-height"]&&a(".forms-iframe").css("height",d["iframe-height"])}))},reflowEditorOnTabToggle:function(){a('a[data-toggle="tab"]').on("shown.bs.tab",function(b){var c=a(a(b.target).attr("href")),d=c.find("iframe[id^=epiceditor-]"),e=[];d.each(function(b,c){e.push(a(c).attr("id"))}),a(h).each(function(b,c){-1!==a.inArray(c._instanceId,e)&&c.reflow()})})}}}(jQuery,HIGHLIGHTJS_SRC,_);