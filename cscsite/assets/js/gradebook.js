!function(a){"use strict";a.fn.fileinputLocales={},String.prototype.repl=function(a,b){return this.split(a).join(b)};var b=function(a){var b,c=document.createElement("div");return c.innerHTML="<!--[if IE "+a+"]><i></i><![endif]-->",b=1===c.getElementsByTagName("i").length,document.body.appendChild(c),c.parentNode.removeChild(c),b},c={data:{},init:function(a){var b=a.initialPreview,d=a.id;b.length>0&&!M(b)&&(b=b.split(a.initialPreviewDelimiter)),c.data[d]={content:b,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags,delimiter:a.initialPreviewDelimiter,template:a.previewGenericTemplate,msg:function(b){return a.getMsgSelected(b)},initId:a.previewInitId,footer:a.getLayoutTemplate("footer"),isDelete:a.initialPreviewShowDelete,caption:a.initialCaption,actions:function(b,c,d,e,f){return a.renderFileActions(b,c,d,e,f)}}},fetch:function(a){return c.data[a].content.filter(function(a){return null!==a})},count:function(a,b){return c.data[a]&&c.data[a].content?b?c.data[a].content.length:c.fetch(a).length:0},get:function(a,b,d){var e,f="init_"+b,g=c.data[a],h=g.initId+"-"+f;return d=void 0===d?!0:d,null===g.content[b]?"":(e=g.template.repl("{previewId}",h).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",f).repl("{content}",g.content[b]).repl("{footer}",c.footer(a,b,d)),g.tags.length&&g.tags[b]&&(e=R(e,g.tags[b])),e)},add:function(b,d,e,f,g){var h,i=a.extend(!0,{},c.data[b]);return M(d)||(d=d.split(i.delimiter)),g?(h=i.content.push(d)-1,i.config[h]=e,i.tags[h]=f):(h=d.length,i.content=d,i.config=e,i.tags=f),c.data[b]=i,h},set:function(b,d,e,f,g){var h,i=a.extend(!0,{},c.data[b]);if(M(d)||(d=d.split(i.delimiter)),g){for(h=0;h<d.length;h++)i.content.push(d[h]);for(h=0;h<e.length;h++)i.config.push(e[h]);for(h=0;h<f.length;h++)i.tags.push(f[h])}else i.content=d,i.config=e,i.tags=f;c.data[b]=i},unset:function(a,b){var d=c.count(a);if(d){if(1===d)return c.data[a].content=[],void(c.data[a].config=[]);c.data[a].content[b]=null,c.data[a].config[b]=null}},out:function(a){var b,d="",e=c.data[a],f=c.count(a,!0);if(0===f)return{content:"",caption:""};for(var g=0;f>g;g++)d+=c.get(a,g);return b=e.msg(c.count(a)),{content:d,caption:b}},footer:function(a,b,d){var e=c.data[a];if(d=void 0===d?!0:d,0===e.config.length||L(e.config[b]))return"";var f=e.config[b],g=N("caption",f)?f.caption:"",h=N("width",f)?f.width:"auto",i=N("url",f)?f.url:!1,j=N("key",f)?f.key:null,k=i===!1&&d,l=e.isDelete?e.actions(!1,!0,k,i,j):"",m=e.footer.repl("{actions}",l);return m.repl("{caption}",g).repl("{width}",h).repl("{indicator}","").repl("{indicatorTitle}","")}},d=function(a,b){return b=b||0,"number"==typeof a?a:("string"==typeof a&&(a=parseFloat(a)),isNaN(a)?b:a)},e=function(){return window.File&&window.FileReader},f=function(){var a=document.createElement("div");return!b(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},g=function(){return e&&window.FormData},h=function(a,b){a.removeClass(b).addClass(b)},i='style="width:{width};height:{height};"',j='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',k='<div class="file-preview-other">\n       {previewFileIcon}\n   </div>',l={removeIcon:'<i class="glyphicon glyphicon-trash text-danger"></i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"></i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},m='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',n='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',o='<div class="file-preview {class}">\n    <div class="close fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',p='<span class="glyphicon glyphicon-file kv-caption-icon"></span>',q='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',r='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',s='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',t='<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',u='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',v='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',w='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',x='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',y='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+k+"\n    </object>\n   {footer}\n</div>",z='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+i+">\n   {footer}\n</div>\n",A='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+i+">\n       {data}\n   </div>\n   {footer}\n</div>",B='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+i+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+k+"\n   </video>\n   {footer}\n</div>\n",C='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+i+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+k+"\n   </audio>\n   {footer}\n</div>",D='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+i+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+j+"       "+k+"\n   </object>\n   {footer}\n</div>\n",E='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+i+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+j+"         "+k+"\n   </object>\n   {footer}\n</div>",F='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+i+">\n   "+k+"\n   {footer}\n</div>",G={main1:m,main2:n,preview:o,icon:p,caption:q,modal:r,progress:s,footer:t,actions:u,actionDelete:v,actionUpload:w},H={generic:x,html:y,image:z,text:A,video:B,audio:C,flash:D,object:E,other:F},I=["image","html","text","video","audio","flash","object"],J={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},K={image:function(a,b){return void 0!==a?a.match("image.*"):b.match(/\.(gif|png|jpe?g)$/i)},html:function(a,b){return void 0!==a?"text/html"===a:b.match(/\.(htm|html)$/i)},text:function(a,b){return void 0!==a&&a.match("text.*")||b.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(a,b){return void 0!==a&&a.match(/\.video\/(ogg|mp4|webm)$/i)||b.match(/\.(og?|mp4|webm)$/i)},audio:function(a,b){return void 0!==a&&a.match(/\.audio\/(ogg|mp3|wav)$/i)||b.match(/\.(ogg|mp3|wav)$/i)},flash:function(a,b){return void 0!==a&&"application/x-shockwave-flash"===a||b.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},L=function(b,c){return null===b||void 0===b||0===b.length||c&&""===a.trim(b)},M=function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},N=function(a,b){return"object"==typeof b&&a in b},O=function(b,c,d){return L(b)||L(b[c])?d:a(b[c])},P=function(){return Math.round((new Date).getTime()+100*Math.random())},Q=function(a){return String(a).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},R=function(b,c){var d=b;return c=c||{},a.each(c,function(a,b){"function"==typeof b&&(b=b()),d=d.repl(a,b)}),d},S=window.URL||window.webkitURL,T=function(c,d){var f=this;f.$element=a(c),f.validate()&&(e()||b(9)?(f.init(d),f.listen()):f.$element.removeClass("file-loading"))};T.prototype={constructor:T,validate:function(){var a,b=this;return"file"===b.$element.attr("type")?!0:(a='<div class="help-block alert alert-warning"><h4>Invalid Input Type</h4>You must set an input <code>type = file</code> for <b>bootstrap-fileinput</b> plugin to initialize.</div>',b.$element.after(a),!1)},init:function(e){var i,j=this,k=j.$element;a.each(e,function(a,b){j[a]="maxFileCount"===a||"maxFileSize"===a?d(b):b}),j.fileInputCleared=!1,j.fileBatchCompleted=!0,L(j.allowedPreviewTypes)&&(j.allowedPreviewTypes=I),j.uploadFileAttr=L(k.attr("name"))?"file_data":k.attr("name"),j.reader=null,j.formdata={},j.isIE9=b(9),j.isIE10=b(10),j.filestack=[],j.ajaxRequests=[],j.isError=!1,j.ajaxAborted=!1,j.dropZoneEnabled=f()&&j.dropZoneEnabled,j.isDisabled=j.$element.attr("disabled")||j.$element.attr("readonly"),j.isUploadable=g&&!L(j.uploadUrl),j.slug="function"==typeof e.slugCallback?e.slugCallback:j.slugDefault,j.mainTemplate=j.getLayoutTemplate(j.showCaption?"main1":"main2"),j.captionTemplate=j.getLayoutTemplate("caption"),j.previewGenericTemplate=j.getPreviewTemplate("generic"),L(j.$element.attr("id"))&&j.$element.attr("id",P()),void 0===j.$container?j.$container=j.createContainer():j.refreshContainer(),j.$progress=j.$container.find(".kv-upload-progress"),j.$btnUpload=j.$container.find(".kv-fileinput-upload"),j.$captionContainer=O(e,"elCaptionContainer",j.$container.find(".file-caption")),j.$caption=O(e,"elCaptionText",j.$container.find(".file-caption-name")),j.$previewContainer=O(e,"elPreviewContainer",j.$container.find(".file-preview")),j.$preview=O(e,"elPreviewImage",j.$container.find(".file-preview-thumbnails")),j.$previewStatus=O(e,"elPreviewStatus",j.$container.find(".file-preview-status")),j.$errorContainer=O(e,"elErrorContainer",j.$previewContainer.find(".kv-fileinput-error")),L(j.msgErrorClass)||h(j.$errorContainer,j.msgErrorClass),j.$errorContainer.hide(),j.fileActionSettings=a.extend(l,e.fileActionSettings),j.previewInitId="preview-"+P(),j.id=j.$element.attr("id"),c.init(j),j.initPreview(!0),j.initPreviewDeletes(),j.options=e,j.setFileDropZoneTitle(),j.uploadCount=0,j.uploadPercent=0,j.$element.removeClass("file-loading"),i=j.getLayoutTemplate("progress"),j.progressTemplate=i.replace("{class}",j.progressClass),j.progressCompleteTemplate=i.replace("{class}",j.progressCompleteClass),j.setEllipsis()},parseError:function(b,c,d){var e=this,f=a.trim(c+""),g="."===f.slice(-1)?"":".",h=void 0!==b.responseJSON&&void 0!==b.responseJSON.error?b.responseJSON.error:b.responseText;return e.showAjaxErrorDetails?(h=a.trim(h.replace(/\n\s*\n/g,"\n")),h=h.length>0?"<pre>"+h+"</pre>":"",f+=g+h):f+=g,d?"<b>"+d+": </b>"+b:f},raise:function(b,c){var d=this,e=a.Event(b),f=!1;if(void 0!==c?d.$element.trigger(e,c):d.$element.trigger(e),e.result&&(f=!0),f)switch(b){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":break;default:d.ajaxAborted=f}},getLayoutTemplate:function(a){var b=this,c=N(a,b.layoutTemplates)?b.layoutTemplates[a]:G[a];return L(b.customLayoutTags)?c:R(c,b.customLayoutTags)},getPreviewTemplate:function(a){var b=this,c=N(a,b.previewTemplates)?b.previewTemplates[a]:H[a];return c=c.repl("{previewFileIcon}",b.previewFileIcon),L(b.customPreviewTags)?c:R(c,b.customPreviewTags)},getOutData:function(a,b,c){var d=this;return a=a||{},b=b||{},c=c||d.filestack.slice(0)||{},{form:d.formdata,files:c,extra:d.getExtraData(),response:b,reader:d.reader,jqXHR:a}},setEllipsis:function(){var a=this,b=a.$captionContainer,c=a.$caption,d=c.clone().css("height","auto").hide();b.parent().before(d),b.removeClass("kv-has-ellipsis"),d.outerWidth()>c.outerWidth()&&b.addClass("kv-has-ellipsis"),d.remove()},listen:function(){var b=this,c=b.$element,d=b.$captionContainer,e=b.$btnFile,f=c.closest("form");c.on("change",a.proxy(b.change,b)),a(window).on("resize",function(){b.setEllipsis()}),e.off("click").on("click",function(){b.raise("filebrowse"),b.isError&&!b.isUploadable&&b.clear(),d.focus()}),f.off("reset").on("reset",a.proxy(b.reset,b)),b.$container.off("click").on("click",".fileinput-remove:not([disabled])",a.proxy(b.clear,b)).on("click",".fileinput-cancel",a.proxy(b.cancel,b)),b.isUploadable&&b.dropZoneEnabled&&b.showPreview&&b.initDragDrop(),b.isUploadable||f.on("submit",a.proxy(b.submitForm,b)),b.$container.find(".kv-fileinput-upload").off("click").on("click",function(c){b.isUploadable&&(c.preventDefault(),!a(this).hasClass("disabled")&&L(a(this).attr("disabled"))&&b.upload())})},submitForm:function(){var a=this,b=a.$element,c=b.get(0).files;return c&&c.length<a.minFileCount&&a.minFileCount>0?(a.noFilesError({}),!1):!a.abort({})},abort:function(b){var c,d=this;return d.ajaxAborted&&"object"==typeof d.ajaxAborted&&void 0!==d.ajaxAborted.message?(c=void 0!==d.ajaxAborted.data?d.getOutData({},d.ajaxAborted.data):d.getOutData(),c=a.extend(c,b),d.showUploadError(d.ajaxAborted.message,c,"filecustomerror"),!0):!1},noFilesError:function(a){var b=this,c=b.minFileCount>1?b.filePlural:b.fileSingle,d=b.msgFilesTooLess.repl("{n}",b.minFileCount).repl("{files}",c),e=b.$errorContainer;e.html(d),b.isError=!0,b.updateFileDetails(0),e.fadeIn(800),b.raise("fileerror",[a]),b.clearFileInput(),h(b.$container,"has-error")},setProgress:function(a){var b=this,c=Math.min(a,100),d=100>c?b.progressTemplate:b.progressCompleteTemplate;b.$progress.html(d.repl("{percent}",c))},upload:function(){var b,c,d,e=this,f=e.getFileStack().length,g={},h=!a.isEmptyObject(e.getExtraData());if(f<e.minFileCount&&e.minFileCount>0)return void e.noFilesError(g);if(e.isUploadable&&!e.isDisabled&&(0!==f||h)){if(e.resetUpload(),e.$progress.removeClass("hide"),e.uploadCount=0,e.uploadPercent=0,e.lock(),e.setProgress(0),0===f&&h)return void e.uploadExtraOnly();if(d=e.filestack.length,e.hasInitData=!1,e.uploadAsync&&e.showPreview)for(c=e.getOutData(),e.raise("filebatchpreupload",[c]),e.fileBatchCompleted=!1,e.uploadCache={content:[],config:[],tags:[],append:!0},b=0;d>b;b+=1)void 0!==e.filestack[b]&&e.uploadSingle(b,e.filestack,!0);else e.uploadBatch()}},lock:function(){var a=this;a.resetErrors(),a.disable(),a.showRemove&&h(a.$container.find(".fileinput-remove"),"hide"),a.showCancel&&a.$container.find(".fileinput-cancel").removeClass("hide"),a.raise("filelock",[a.filestack,a.getExtraData()])},unlock:function(a){var b=this;void 0===a&&(a=!0),b.enable(),b.showCancel&&h(b.$container.find(".fileinput-cancel"),"hide"),b.showRemove&&b.$container.find(".fileinput-remove").removeClass("hide"),a&&b.resetFileStack(),b.raise("fileunlock",[b.filestack,b.getExtraData()])},resetFileStack:function(){var b=this,c=0,d=[];b.getThumbs().each(function(){var e=a(this),f=e.attr("data-fileindex"),g=b.filestack[f];-1!==f&&(void 0!==g?(d[c]=g,e.attr({id:b.previewInitId+"-"+c,"data-fileindex":c}),c+=1):e.attr({id:"uploaded-"+P(),"data-fileindex":"-1"}))}),b.filestack=d},refresh:function(b){var c,d=this,e=d.$element,f=arguments.length?a.extend(d.options,b):d.options;e.off(),d.init(f),c=d.$container.find(".file-drop-zone"),c.off("dragenter dragover drop"),a(document).off("dragenter dragover drop"),d.listen(),d.setFileDropZoneTitle()},initDragDrop:function(){var b=this,c=b.$container.find(".file-drop-zone");c.off("dragenter dragover drop"),a(document).off("dragenter dragover drop"),c.on("dragenter dragover",function(c){c.stopPropagation(),c.preventDefault(),b.isDisabled||h(a(this),"highlighted")}),c.on("dragleave",function(c){c.stopPropagation(),c.preventDefault(),b.isDisabled||a(this).removeClass("highlighted")}),c.on("drop",function(c){c.preventDefault(),b.isDisabled||(b.change(c,"dragdrop"),a(this).removeClass("highlighted"))}),a(document).on("dragenter dragover drop",function(a){a.stopPropagation(),a.preventDefault()})},setFileDropZoneTitle:function(){var a=this,b=a.$container.find(".file-drop-zone");b.find("."+a.dropZoneTitleClass).remove(),a.isUploadable&&a.showPreview&&0!==b.length&&!(a.getFileStack().length>0)&&a.dropZoneEnabled&&(0===b.find(".file-preview-frame").length&&b.prepend('<div class="'+a.dropZoneTitleClass+'">'+a.dropZoneTitle+"</div>"),a.$container.removeClass("file-input-new"),h(a.$container,"file-input-ajax-new"))},initFileActions:function(){var b=this;b.$preview.find(".kv-file-remove").each(function(){var d,e,f=a(this),g=f.closest(".file-preview-frame"),h=g.attr("data-fileindex");f.off("click").on("click",function(){g.fadeOut("slow",function(){b.filestack[h]=void 0,b.clearObjects(g),g.remove();var a=b.getFileStack(),f=a.length,i=c.count(b.id);b.clearFileInput(),0===f&&0===i?b.reset():(d=i+f,e=d>1?b.getMsgSelected(d):a[0].name,b.setCaption(e))})})}),b.$preview.find(".kv-file-upload").each(function(){var c=a(this);c.off("click").on("click",function(){var a=c.closest(".file-preview-frame"),d=a.attr("data-fileindex");b.uploadSingle(d,b.filestack,!1)})})},getMsgSelected:function(a){var b=this,c=1===a?b.fileSingle:b.filePlural;return b.msgSelected.repl("{n}",a).repl("{files}",c)},renderFileFooter:function(a,b){var c,d,e=this,f=e.fileActionSettings,g=e.getLayoutTemplate("footer");return e.isUploadable?(c=g.repl("{actions}",e.renderFileActions(!0,!0,!1,!1,!1)),d=c.repl("{caption}",a).repl("{width}",b).repl("{indicator}",f.indicatorNew).repl("{indicatorTitle}",f.indicatorNewTitle)):d=g.repl("{actions}","").repl("{caption}",a).repl("{width}",b).repl("{indicator}","").repl("{indicatorTitle}",""),d=R(d,e.previewThumbTags)},renderFileActions:function(a,b,c,d,e){if(!a&&!b)return"";var f=this,g=d===!1?"":' data-url="'+d+'"',h=e===!1?"":' data-key="'+e+'"',i=f.getLayoutTemplate("actionDelete"),j="",k=f.getLayoutTemplate("actions"),l=f.otherActionButtons.repl("{dataKey}",h),m=f.fileActionSettings,n=c?m.removeClass+" disabled":m.removeClass;return i=i.repl("{removeClass}",n).repl("{removeIcon}",m.removeIcon).repl("{removeTitle}",m.removeTitle).repl("{dataUrl}",g).repl("{dataKey}",h),a&&(j=f.getLayoutTemplate("actionUpload").repl("{uploadClass}",m.uploadClass).repl("{uploadIcon}",m.uploadIcon).repl("{uploadTitle}",m.uploadTitle)),k.repl("{delete}",i).repl("{upload}",j).repl("{other}",l)},initPreview:function(a){var b,d=this,e=d.initialCaption||"";return c.count(d.id)?(b=c.out(d.id),e=a&&d.initialCaption?d.initialCaption:b.caption,d.$preview.html(b.content),d.setCaption(e),void(L(b.content)||d.$container.removeClass("file-input-new"))):(d.$preview.html(""),void(a?d.setCaption(e):d.initCaption()))},initPreviewDeletes:function(){var b=this,d=b.deleteExtraData||{},e=function(){0===b.$preview.find(".kv-file-remove").length&&(b.reset(),b.initialCaption="")};b.$preview.find(".kv-file-remove").each(function(){var f=a(this),g=f.data("url")||b.deleteUrl,i=f.data("key");if(!L(g)&&void 0!==i){var j,k,l,m,n=f.closest(".file-preview-frame"),o=c.data[b.id],p=n.data("fileindex");p=parseInt(p.replace("init_","")),l=L(o.config)&&L(o.config[p])?null:o.config[p],m=L(l)||L(l.extra)?d:l.extra,"function"==typeof m&&(m=m()),k={id:f.attr("id"),key:i,extra:m},j=a.extend({url:g,type:"DELETE",dataType:"json",data:a.extend({key:i},m),beforeSend:function(a){b.ajaxAborted=!1,b.raise("filepredelete",[i,a,m]),b.ajaxAborted?a.abort():(h(n,"file-uploading"),h(f,"disabled"))},success:function(a,d,g){var h,j;return void 0!==a&&void 0!==a.error?(k.jqXHR=g,k.response=a,b.showError(a.error,k,"filedeleteerror"),n.removeClass("file-uploading"),f.removeClass("disabled"),void e()):(c.unset(b.id,p),h=c.count(b.id),j=h>0?b.getMsgSelected(h):"",b.raise("filedeleted",[i,g,m]),b.setCaption(j),n.removeClass("file-uploading").addClass("file-deleted"),void n.fadeOut("slow",function(){b.clearObjects(n),n.remove(),e(),h||0!==b.getFileStack().length||(b.setCaption(""),b.reset())}))},error:function(a,c,d){var f=b.parseError(a,d);k.jqXHR=a,k.response={},b.showError(f,k,"filedeleteerror"),n.removeClass("file-uploading"),e()}},b.ajaxDeleteSettings),f.off("click").on("click",function(){a.ajax(j)})}})},clearObjects:function(b){b.find("video audio").each(function(){this.pause(),a(this).remove()}),b.find("img object div").each(function(){a(this).remove()})},clearFileInput:function(){var b,c,d,e=this,f=e.$element;L(f.val())||(e.isIE9||e.isIE10?(b=f.closest("form"),c=a(document.createElement("form")),d=a(document.createElement("div")),f.before(d),b.length?b.after(c):d.after(c),c.append(f).trigger("reset"),d.before(f).remove(),c.remove()):f.val(""),e.fileInputCleared=!0)},resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:!0},a.uploadCount=0,a.uploadPercent=0,a.$btnUpload.removeAttr("disabled"),a.setProgress(0),h(a.$progress,"hide"),a.resetErrors(!1),a.ajaxAborted=!1,a.ajaxRequests=[]},cancel:function(){var b,c=this,d=c.ajaxRequests,e=d.length;if(e>0)for(b=0;e>b;b+=1)d[b].abort();c.getThumbs().each(function(){var b=a(this),d=b.attr("data-fileindex");b.removeClass("file-uploading"),void 0!==c.filestack[d]&&(b.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),b.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),c.unlock()})},clear:function(){var b,d=this;d.$btnUpload.removeAttr("disabled"),d.resetUpload(),d.filestack=[],d.clearFileInput(),d.resetErrors(!0),d.raise("fileclear"),!d.overwriteInitial&&c.count(d.id)?(d.showFileIcon(),d.resetPreview(),d.setEllipsis(),d.initPreviewDeletes(),d.$container.removeClass("file-input-new")):(d.getThumbs().each(function(){d.clearObjects(a(this))}),d.$preview.html(""),b=!d.overwriteInitial&&d.initialCaption.length>0?d.initialCaption:"",d.setCaption(b),d.setEllipsis(),d.$caption.attr("title",""),h(d.$container,"file-input-new")),0===d.$container.find(".file-preview-frame").length&&(d.initCaption()||d.$captionContainer.find(".kv-caption-icon").hide(),d.setEllipsis()),d.hideFileIcon(),d.raise("filecleared"),d.$captionContainer.focus(),d.setFileDropZoneTitle()},resetPreview:function(){var a,b=this;c.count(b.id)?(a=c.out(b.id),b.$preview.html(a.content),b.setCaption(a.caption)):(b.$preview.html(""),b.initCaption())},reset:function(){var a=this;a.clear(),a.resetPreview(),a.setEllipsis(),a.$container.find(".fileinput-filename").text(""),a.raise("filereset"),a.initialPreview.length>0&&a.$container.removeClass("file-input-new"),a.setFileDropZoneTitle(),a.filestack=[],a.formdata={}},disable:function(){var a=this;a.isDisabled=!0,a.raise("filedisabled"),a.$element.attr("disabled","disabled"),a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0),a.initDragDrop()},enable:function(){var a=this;a.isDisabled=!1,a.raise("fileenabled"),a.$element.removeAttr("disabled"),a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),a.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled"),a.initDragDrop()},getThumbs:function(a){return a=a||"",this.$preview.find(".file-preview-frame:not(.file-preview-initial)"+a)},getExtraData:function(){var a=this,b=a.uploadExtraData;return"function"==typeof a.uploadExtraData&&(b=a.uploadExtraData()),b},uploadExtra:function(){var b=this,c=b.getExtraData();0!==c.length&&a.each(c,function(a,c){b.formdata.append(a,c)})},initXhr:function(a,b){var c=this;return a.upload&&a.upload.addEventListener("progress",function(a){var d=0,e=a.loaded||a.position,f=a.total;a.lengthComputable&&(d=Math.ceil(e/f*b)),c.uploadPercent=Math.max(d,c.uploadPercent),c.setProgress(c.uploadPercent)},!1),a},ajaxSubmit:function(b,c,d,e){var f,g=this;g.uploadExtra(),f=a.extend({xhr:function(){var b=a.ajaxSettings.xhr();return g.initXhr(b,98)},url:g.uploadUrl,type:"POST",dataType:"json",data:g.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:b,success:c,complete:d,error:e},g.ajaxSettings),g.ajaxRequests.push(a.ajax(f))},initUploadSuccess:function(b,d,e){var f,g,h,i,j,k,l,m=this;"object"!=typeof b||a.isEmptyObject(b)||void 0!==b.initialPreview&&b.initialPreview.length>0&&(m.hasInitData=!0,j=b.initialPreview||[],k=b.initialPreviewConfig||[],l=b.initialPreviewThumbTags||[],f=!(void 0!==b.append&&!b.append),m.overwriteInitial=!1,void 0===d||e?e?(m.uploadCache.content.push(j[0]),m.uploadCache.config.push(k[0]),m.uploadCache.tags.push(l[0]),m.uploadCache.append=f):(c.set(m.id,j,k,l,f),m.initPreview(),m.initPreviewDeletes()):(h=c.add(m.id,j,k[0],l[0],f),g=c.get(m.id,h,!1),i=a(g).hide(),d.after(i).fadeOut("slow",function(){i.fadeIn("slow").css("display:inline-block"),m.initPreviewDeletes(),m.clearFileInput()})))},uploadSingle:function(b,d,e){var f,g,i,j,k,l,m,n,o,p,q=this,r=q.getFileStack().length,s=new FormData,t=q.previewInitId+"-"+b,u=a("#"+t+":not(.file-preview-initial)"),v=u.find(".kv-file-upload"),w=u.find(".kv-file-remove"),x=u.find(".file-upload-indicator"),y=q.fileActionSettings,z=q.filestack.length>0||!a.isEmptyObject(q.uploadExtraData),A={id:t,index:b};q.formdata=s,0===r||!z||v.hasClass("disabled")||q.abort(A)||(i=function(){var a=q.getThumbs(".file-uploading");a.length>0||q.fileBatchCompleted||(q.fileBatchCompleted=!0,setTimeout(function(){c.set(q.id,q.uploadCache.content,q.uploadCache.config,q.uploadCache.tags,q.uploadCache.append),q.hasInitData&&(q.initPreview(),q.initPreviewDeletes()),q.setProgress(100),q.unlock(),q.clearFileInput(),q.raise("filebatchuploadcomplete",[q.filestack,q.getExtraData()])},100))},j=function(a,b){x.html(y[a]),x.attr("title",y[b])},k=function(){!e||0===r||q.uploadPercent>=100||(q.uploadCount+=1,g=80+Math.ceil(20*q.uploadCount/r),q.uploadPercent=Math.max(g,q.uploadPercent),q.setProgress(q.uploadPercent),q.initPreviewDeletes())},l=function(){v.removeAttr("disabled"),w.removeAttr("disabled"),u.removeClass("file-uploading")},m=function(c){f=q.getOutData(c),j("indicatorLoading","indicatorLoadingTitle"),h(u,"file-uploading"),v.attr("disabled",!0),w.attr("disabled",!0),e||q.lock(),q.raise("filepreupload",[f,t,b]),A=a.extend(A,f),q.abort(A)&&(c.abort(),q.setProgress(100))},n=function(c,d,g){f=q.getOutData(g,c),A=a.extend(A,f),setTimeout(function(){void 0===c.error?(j("indicatorSuccess","indicatorSuccessTitle"),v.hide(),w.hide(),q.filestack[b]=void 0,q.raise("fileuploaded",[f,t,b]),q.initUploadSuccess(c,u,e),e||q.resetFileStack()):(j("indicatorError","indicatorErrorTitle"),q.showUploadError(c.error,A))},100)},o=function(){setTimeout(function(){k(),l(),e?i():q.unlock(!1)},100)},p=function(c,f,g){var h=q.parseError(c,g,e?d[b].name:null);j("indicatorError","indicatorErrorTitle"),A=a.extend(A,q.getOutData(c)),q.showUploadError(h,A)},s.append(q.uploadFileAttr,d[b]),s.append("file_id",b),q.ajaxSubmit(m,n,o,p))},uploadBatch:function(){var b,c,d,e,f,g,i,j,k=this,l=k.filestack,m=l.length,n=k.filestack.length>0||!a.isEmptyObject(k.uploadExtraData),o={};k.formdata=new FormData,0!==m&&n&&!k.abort(o)&&(b=k.fileActionSettings,c=function(c,d,e){var f=a("#"+k.previewInitId+"-"+c).find(".file-upload-indicator");f.html(b[d]),f.attr("title",b[e])},e=function(b){var c=a("#"+k.previewInitId+"-"+b+":not(.file-preview-initial)"),d=c.find(".kv-file-upload"),e=c.find(".kv-file-delete");c.removeClass("file-uploading"),d.removeAttr("disabled"),e.removeAttr("disabled")},d=function(){a.each(l,function(a){k.filestack[a]=void 0}),k.clearFileInput()},f=function(b){k.lock();var c=k.getOutData(b);k.showPreview&&k.getThumbs().each(function(){var b=a(this),c=b.find(".kv-file-upload"),d=b.find(".kv-file-remove");h(b,"file-uploading"),c.attr("disabled",!0),d.attr("disabled",!0)}),k.raise("filebatchpreupload",[c]),k.abort(c)&&b.abort()},g=function(b,f,g){var h=k.getOutData(g,b),i=k.getThumbs(),j=L(b.errorkeys)?[]:b.errorkeys;void 0===b.error||L(b.error)?(k.raise("filebatchuploadsuccess",[h]),d(),k.showPreview?(i.find(".kv-file-upload").hide(),i.find(".kv-file-remove").hide(),i.each(function(){var b=a(this),d=b.attr("data-fileindex");c(d,"indicatorSuccess","indicatorSuccessTitle"),e(d)}),k.initUploadSuccess(b)):k.reset()):(k.showPreview&&(i.each(function(){var b=a(this),d=parseInt(b.attr("data-fileindex"),10);return e(d),0===j.length?void c(d,"indicatorError","indicatorErrorTitle"):void(-1!==a.inArray(d,j)?c(d,"indicatorError","indicatorErrorTitle"):(b.find(".kv-file-upload").hide(),b.find(".kv-file-remove").hide(),c(d,"indicatorSuccess","indicatorSuccessTitle"),k.filestack[d]=void 0))}),k.initUploadSuccess(b)),k.showUploadError(b.error,h,"filebatchuploaderror"))},i=function(){k.setProgress(100),k.unlock(),k.raise("filebatchuploadcomplete",[k.filestack,k.getExtraData()]),k.clearFileInput()},j=function(b,d,e){var f=k.getOutData(b),g=k.parseError(b,e);k.showUploadError(g,f,"filebatchuploaderror"),k.uploadFileCount=m-1,k.showPreview&&(k.getThumbs().each(function(){var b=a(this),d=b.attr("data-fileindex");b.removeClass("file-uploading"),void 0!==k.filestack[d]&&c(d,"indicatorError","indicatorErrorTitle")}),k.getThumbs().removeClass("file-uploading"),k.getThumbs(" .kv-file-upload").removeAttr("disabled"),k.getThumbs(" .kv-file-delete").removeAttr("disabled"))},a.each(l,function(a,b){L(l[a])||k.formdata.append(k.uploadFileAttr,b)}),k.ajaxSubmit(f,g,i,j))},uploadExtraOnly:function(){var a,b,c,d,e=this,f={};e.formdata=new FormData,e.abort(f)||(a=function(a){e.lock();var b=e.getOutData(a);e.raise("filebatchpreupload",[b]),e.setProgress(50),f.data=b,f.xhr=a,e.abort(f)&&(a.abort(),e.setProgress(100))},b=function(a,b,c){var d=e.getOutData(c,a);void 0===a.error||L(a.error)?(e.raise("filebatchuploadsuccess",[d]),e.clearFileInput(),e.initUploadSuccess(a)):e.showUploadError(a.error,d,"filebatchuploaderror")},c=function(){e.setProgress(100),e.unlock(),e.raise("filebatchuploadcomplete",[e.filestack,e.getExtraData()]),e.clearFileInput()},d=function(a,b,c){var d=e.getOutData(a),g=e.parseError(a,c);f.data=d,e.showUploadError(g,d,"filebatchuploaderror");
},e.ajaxSubmit(a,b,c,d))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(a){var b=this,c=b.$errorContainer;b.isError=!1,b.$container.removeClass("has-error"),c.html(""),a?c.fadeOut("slow"):c.hide()},showFolderError:function(a){var b=this,c=b.$errorContainer;a&&(c.html(b.msgFoldersNotAllowed.repl("{n}",a)),c.fadeIn(800),h(b.$container,"has-error"),b.raise("filefoldererror",[a]))},showUploadError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileuploaderror";return 0===e.find("ul").length?e.html("<ul><li>"+a+"</li></ul>"):e.find("ul").append("<li>"+a+"</li>"),e.fadeIn(800),d.raise(f,[b]),h(d.$container,"has-error"),!0},showError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileerror";return b=b||{},b.reader=d.reader,e.html(a),e.fadeIn(800),d.raise(f,[b]),d.isUploadable||d.clearFileInput(),h(d.$container,"has-error"),d.$btnUpload.attr("disabled",!0),!0},errorHandler:function(a,b){var c=this,d=a.target.error;switch(d.code){case d.NOT_FOUND_ERR:c.showError(c.msgFileNotFound.repl("{name}",b));break;case d.SECURITY_ERR:c.showError(c.msgFileSecured.repl("{name}",b));break;case d.NOT_READABLE_ERR:c.showError(c.msgFileNotReadable.repl("{name}",b));break;case d.ABORT_ERR:c.showError(c.msgFilePreviewAborted.repl("{name}",b));break;default:c.showError(c.msgFilePreviewError.repl("{name}",b))}},parseFileType:function(a){var b,c,d,e,f=this;for(e=0;e<I.length;e+=1)if(d=I[e],b=N(d,f.fileTypeSettings)?f.fileTypeSettings[d]:K[d],c=b(a.type,a.name)?d:"",!L(c))return c;return"other"},previewDefault:function(b,c,d){if(this.showPreview){var e=this,f=S.createObjectURL(b),g=a("#"+c),h=e.previewSettings.other,i=e.renderFileFooter(b.name,h.width),j=e.getPreviewTemplate("other"),k=c.slice(c.lastIndexOf("-")+1),l="";d===!0&&(l=" btn disabled",i+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'),e.$preview.append("\n"+j.repl("{previewId}",c).repl("{frameClass}",l).repl("{fileindex}",k).repl("{caption}",e.slug(b.name)).repl("{width}",h.width).repl("{height}",h.height).repl("{type}",b.type).repl("{data}",f).repl("{footer}",i)),g.on("load",function(){S.revokeObjectURL(g.attr("data"))})}},previewFile:function(a,b,c,d){if(this.showPreview){var e,f,g,h,i=this,j=i.parseFileType(a),k=i.slug(a.name),l=i.allowedPreviewTypes,m=i.allowedPreviewMimeTypes,n=i.getPreviewTemplate(j),o=N(j,i.previewSettings)?i.previewSettings[j]:J[j],p=parseInt(i.wrapTextLength,10),q=i.wrapIndicator,r=l.indexOf(j)>=0,s=L(m)||!L(m)&&-1!==m.indexOf(a.type),t=i.renderFileFooter(k,o.width),u="",v=c.slice(c.lastIndexOf("-")+1);r&&s?("text"===j?(f=Q(b.target.result),S.revokeObjectURL(d),f.length>p&&(g="text-"+P(),h=.75*window.innerHeight,u=i.getLayoutTemplate("modal").repl("{id}",g).repl("{title}",k).repl("{height}",h).repl("{body}",f),q=q.repl("{title}",k).repl("{dialog}","$('#"+g+"').modal('show')"),f=f.substring(0,p-1)+q),e=n.repl("{previewId}",c).repl("{caption}",k).repl("{frameClass}","").repl("{type}",a.type).repl("{width}",o.width).repl("{height}",o.height).repl("{data}",f).repl("{footer}",t).repl("{fileindex}",v)+u):e=n.repl("{previewId}",c).repl("{caption}",k).repl("{frameClass}","").repl("{type}",a.type).repl("{data}",d).repl("{width}",o.width).repl("{height}",o.height).repl("{footer}",t).repl("{fileindex}",v),i.$preview.append("\n"+e),i.autoSizeImage(c)):i.previewDefault(a,c)}},slugDefault:function(a){return L(a)?"":a.split(/(\\|\/)/g).pop().replace(/[^\w\u00C0-\u017F\-.\\\/ ]+/g,"")},getFileStack:function(){var a=this;return a.filestack.filter(function(a){return void 0!==a})},readFiles:function(b){function c(a){if(L(e.attr("multiple"))&&(m=1),a>=m)return d.isUploadable&&d.filestack.length>0?d.raise("filebatchselected",[d.getFileStack()]):d.raise("filebatchselected",[b]),h.removeClass("loading"),void i.html("");var q,r,s,t,u,v,w=o+a,x=l+"-"+w,y=b[a],z=d.slug(y.name),A=(y.size||0)/1e3,B="",C=S.createObjectURL(y),D=0,E=d.allowedFileTypes,F=L(E)?"":E.join(", "),G=d.allowedFileExtensions,H=L(G)?"":G.join(", ");if(L(G)||(B=new RegExp("\\.("+G.join("|")+")$","i")),A=A.toFixed(2),d.maxFileSize>0&&A>d.maxFileSize)return t=d.msgSizeTooLarge.repl("{name}",z).repl("{size}",A).repl("{maxSize}",d.maxFileSize),void(d.isError=p(t,y,x,a));if(!L(E)&&M(E)){for(s=0;s<E.length;s+=1)u=E[s],r=n[u],v=void 0!==r&&r(y.type,z),D+=L(v)?0:v.length;if(0===D)return t=d.msgInvalidFileType.repl("{name}",z).repl("{types}",F),void(d.isError=p(t,y,x,a))}return 0!==D||L(G)||!M(G)||L(B)||(v=z.match(B),D+=L(v)?0:v.length,0!==D)?d.showPreview?(f.length>0&&void 0!==FileReader?(i.html(j.repl("{index}",a+1).repl("{files}",m)),h.addClass("loading"),g.onerror=function(a){d.errorHandler(a,z)},g.onload=function(a){d.previewFile(y,a,x,C),d.initFileActions()},g.onloadend=function(){t=k.repl("{index}",a+1).repl("{files}",m).repl("{percent}",50).repl("{name}",z),setTimeout(function(){i.html(t),S.revokeObjectURL(C)},100),setTimeout(function(){c(a+1),d.updateFileDetails(m)},100),d.raise("fileloaded",[y,x,a,g])},g.onprogress=function(b){if(b.lengthComputable){var c=b.loaded/b.total*100,d=Math.ceil(c);t=k.repl("{index}",a+1).repl("{files}",m).repl("{percent}",d).repl("{name}",z),setTimeout(function(){i.html(t)},100)}},q=N("text",n)?n.text:K.text,q(y.type,z)?g.readAsText(y,d.textEncoding):g.readAsArrayBuffer(y)):(d.previewDefault(y,x),setTimeout(function(){c(a+1),d.updateFileDetails(m)},100),d.raise("fileloaded",[y,x,a,g])),void d.filestack.push(y)):(d.filestack.push(y),setTimeout(c(a+1),100),void d.raise("fileloaded",[y,x,a,g])):(t=d.msgInvalidFileExtension.repl("{name}",z).repl("{extensions}",H),void(d.isError=p(t,y,x,a)))}this.reader=new FileReader;var d=this,e=d.$element,f=d.$preview,g=d.reader,h=d.$previewContainer,i=d.$previewStatus,j=d.msgLoading,k=d.msgProgress,l=d.previewInitId,m=b.length,n=d.fileTypeSettings,o=d.filestack.length,p=function(c,e,f,g){var h=a.extend(d.getOutData({},{},b),{id:f,index:g}),i={id:f,index:g,file:e,files:b};return d.previewDefault(e,f,!0),d.isUploadable?d.showUploadError(c,h):d.showError(c,i)};c(0),d.updateFileDetails(m,!1)},updateFileDetails:function(a){var b=this,d=b.$element,e=b.getFileStack(),f=d.val()||e.length&&e[0].name||"",g=b.slug(f),h=b.isUploadable?e.length:a,i=c.count(b.id)+h,j=h>1?b.getMsgSelected(i):g;b.isError?(b.$previewContainer.removeClass("loading"),b.$previewStatus.html(""),b.$captionContainer.find(".kv-caption-icon").hide()):b.showFileIcon(),b.setCaption(j,b.isError),b.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&b.raise("fileselect",[a,g]),c.count(b.id)&&b.initPreviewDeletes()},change:function(b){var d=this,e=d.$element;if(!d.isUploadable&&L(e.val())&&d.fileInputCleared)return void(d.fileInputCleared=!1);d.fileInputCleared=!1;var f,g,h,i,j=d.$preview,k=arguments.length>1,l=k?b.originalEvent.dataTransfer.files:e.get(0).files,m=L(e.attr("multiple")),n=0,o=0,p=d.filestack.length,q=d.isUploadable,r=function(b,c,e,f){var g=a.extend(d.getOutData({},{},l),{id:e,index:f}),h={id:e,index:f,file:c,files:l};return d.isUploadable?d.showUploadError(b,g):d.showError(b,h)};if(d.reader=null,d.resetUpload(),d.hideFileIcon(),d.isUploadable&&d.$container.find(".file-drop-zone ."+d.dropZoneTitleClass).remove(),k)for(f=[];l[n];)i=l[n],i.type||i.size%4096!==0?f.push(i):o++,n++;else f=void 0===b.target.files?b.target&&b.target.value?[{name:b.target.value.replace(/^.+\\/,"")}]:[]:b.target.files;if(L(f)||0===f.length)return q||d.clear(),d.showFolderError(o),void d.raise("fileselectnone");if(d.resetErrors(),!q||m&&p>0){if(!d.overwriteInitial&&c.count(d.id)){var s=c.out(d.id);j.html(s.content),d.setCaption(s.caption),d.initPreviewDeletes()}else j.html("");m&&p>0&&(d.filestack=[])}return h=d.isUploadable?d.getFileStack().length+f.length:f.length,d.maxFileCount>0&&h>d.maxFileCount?(g=d.msgFilesTooMany.repl("{m}",d.maxFileCount).repl("{n}",h),d.isError=r(g,null,null,null),d.$captionContainer.find(".kv-caption-icon").hide(),d.$caption.html(d.msgValidationError),d.setEllipsis(),void d.$container.removeClass("file-input-new file-input-ajax-new")):(d.isIE9?d.updateFileDetails(1):d.readFiles(f),void d.showFolderError(o))},autoSizeImage:function(a){var b,c,d,e=this,f=e.$preview,g=f.find("#"+a),h=g.find("img");h.length&&h.on("load",function(){b=g.width(),c=f.width(),b>c&&(h.css("width","100%"),g.css("width","97%")),d=h.closest(".file-preview-frame").find(".file-caption-name"),d.length&&(d.width(h.width()),d.attr("title",d.text())),e.raise("fileimageloaded",a)})},initCaption:function(){var a=this,b=a.initialCaption||"";return a.overwriteInitial||L(b)?(a.$caption.html(""),!1):(a.setCaption(b),!0)},setCaption:function(b,c){var d,e,f=this,g=c||!1;if(g)d=a("<div>"+f.msgValidationError+"</div>").text(),e='<span class="'+f.msgValidationErrorClass+'">'+f.msgValidationErrorIcon+d+"</span>";else{if(L(b)||0===f.$caption.length)return;d=a("<div>"+b+"</div>").text(),e=f.getLayoutTemplate("icon")+d}f.$caption.html(e),f.$caption.attr("title",d),f.$captionContainer.find(".file-caption-ellipsis").attr("title",d),f.setEllipsis()},initBrowse:function(a){var b=this;b.$btnFile=a.find(".btn-file"),b.$btnFile.append(b.$element)},createContainer:function(){var b=this,c=a(document.createElement("span")).attr({"class":"file-input file-input-new"}).html(b.renderMain());return b.$element.before(c),b.initBrowse(c),c},refreshContainer:function(){var a=this,b=a.$container;b.before(a.$element),b.html(a.renderMain()),a.initBrowse(b)},renderMain:function(){var a=this,b=a.isUploadable&&a.dropZoneEnabled?" file-drop-zone":"",c=a.showPreview?a.getLayoutTemplate("preview").repl("{class}",a.previewClass).repl("{dropClass}",b):"",d=a.isDisabled?a.captionClass+" file-caption-disabled":a.captionClass,e=a.captionTemplate.repl("{class}",d+" kv-fileinput-caption");return a.mainTemplate.repl("{class}",a.mainClass).repl("{preview}",c).repl("{caption}",e).repl("{upload}",a.renderUpload()).repl("{remove}",a.renderRemove()).repl("{cancel}",a.renderCancel()).repl("{browse}",a.renderBrowse())},renderBrowse:function(){var a=this,b=a.browseClass+" btn-file",c="";return a.isDisabled&&(c=" disabled "),'<div class="'+b+'"'+c+"> "+a.browseIcon+a.browseLabel+" </div>"},renderRemove:function(){var a=this,b=a.removeClass+" fileinput-remove fileinput-remove-button",c="";return a.showRemove?(a.isDisabled&&(c=" disabled "),'<button type="button" title="'+a.removeTitle+'" class="'+b+'"'+c+">"+a.removeIcon+a.removeLabel+"</button>"):""},renderCancel:function(){var a=this,b=a.cancelClass+" fileinput-cancel fileinput-cancel-button";return a.showCancel?'<button type="button" title="'+a.cancelTitle+'" class="hide '+b+'">'+a.cancelIcon+a.cancelLabel+"</button>":""},renderUpload:function(){var a=this,b=a.uploadClass+" kv-fileinput-upload fileinput-upload-button",c="",d="";return a.showUpload?(a.isDisabled&&(d=" disabled "),c=!a.isUploadable||a.isDisabled?'<button type="submit" title="'+a.uploadTitle+'"class="'+b+'"'+d+">"+a.uploadIcon+a.uploadLabel+"</button>":'<a href="'+a.uploadUrl+'" title="'+a.uploadTitle+'" class="'+b+'"'+d+">"+a.uploadIcon+a.uploadLabel+"</a>"):""}},a.fn.fileinput=function(c){if(e()||b(9)){var d=Array.apply(null,arguments);return d.shift(),this.each(function(){var b,e=a(this),f=e.data("fileinput"),g="object"==typeof c&&c,h=g.language||e.data("language")||"en";f||(b=a.extend({},a.fn.fileinput.defaults),"en"===h||L(a.fn.fileinputLocales[h])||(b=a.extend(b,a.fn.fileinputLocales[h])),f=new T(this,a.extend(b,g,e.data())),e.data("fileinput",f)),"string"==typeof c&&f[c].apply(f,d)})}},a.fn.fileinput.defaults={language:"en",showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,layoutTemplates:G,previewTemplates:H,allowedPreviewTypes:I,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:J,fileTypeSettings:K,previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',browseIcon:'<i class="glyphicon glyphicon-folder-open"></i> &nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i> ',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i> ',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"></i> ',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},maxFileSize:0,minFileCount:0,maxFileCount:0,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0},a.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload. Please retry your upload!",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:"File Upload Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",dropZoneTitle:"Drag & drop files here &hellip;"},a.extend(a.fn.fileinput.defaults,a.fn.fileinputLocales.en),a.fn.fileinput.Constructor=T,a(document).ready(function(){var b=a("input.file[type=file]");b.length&&b.fileinput()})}(window.jQuery),function(a){"use strict";a.fn.fileinputLocales.ru={fileSingle:"файл",filePlural:"файлы",browseLabel:"Выбрать &hellip;",removeLabel:"Удалить",removeTitle:"Очистить выбранные файлы",cancelLabel:"Отмена",cancelTitle:"Отменить текущую загрузку",uploadLabel:"Загрузить",uploadTitle:"Загрузить выбранные файлы",msgSizeTooLarge:'Файл "{name}" (<b>{size} KB</b>) превышает максимальный размер <b>{maxSize} KB</b>',msgFilesTooLess:"Вы должны выбрать как минимум <b>{n}</b> {files} для загрузки",msgFilesTooMany:"Количество выбранных файлов <b>({n})</b> превышает максимально допустимое количество <b>{m}</b>",msgFileNotFound:'Файл "{name}" не найден!',msgFileSecured:'Ограничения безопасности запрещают читать файл "{name}".',msgFileNotReadable:'Файл "{name}" невозможно прочитать.',msgFilePreviewAborted:'Предпросмотр отменен для файла "{name}".',msgFilePreviewError:'Произошла ошибка при чтении файла "{name}".',msgInvalidFileType:'Запрещенный тип файла для "{name}". Только "{types}" разрешены.',msgInvalidFileExtension:'Запрещенное расширение для файла "{name}". Только "{extensions}" разрешены.',msgValidationError:"Ошибка при загрузке файла",msgLoading:"Загрузка файла {index} из {files} &hellip;",msgProgress:"Загрузка файла {index} из {files} - {name} - {percent}% завершено.",msgSelected:"{n} {files} выбрано",msgFoldersNotAllowed:"Разрешено только перетаскивание файлов! Пропущено {n} папок.",dropZoneTitle:"Перетащите файлы сюда &hellip;"}}(window.jQuery),function(a){a.arrowIncrement=function(b,c){var d=this;this.opts=a.extend({},c),this.$element=a(b).keydown(function(a){38===a.keyCode?d.increment():40===a.keyCode&&d.decrement()})},a.arrowIncrement.prototype.increment=function(b){var c,d,e=this.$element.val();c=this.opts.parseFn?this.opts.parseFn(e):a.arrowIncrement.parse(e),isNaN(c)||(d=a.arrowIncrement.compute(c,b,this.opts),this.opts.formatFn&&(d=this.opts.formatFn(d)),this.$element.val(d).change())},a.arrowIncrement.prototype.decrement=function(){this.increment(!0)},a.arrowIncrement.compute=function(b,c,d){var e,f,g=1,h=d&&"number"==typeof d.min,i=d&&"number"==typeof d.max;if(d&&"number"==typeof d.delta&&(g=d.delta),c){if(h&&b<d.min)return b;e=b-g}else{if(i&&b>d.max)return b;e=b+g}return f=Math.max(a.arrowIncrement.decimals(b),a.arrowIncrement.decimals(g)),e=+e.toFixed(f),h&&e<d.min&&(e=d.min),i&&e>d.max&&(e=d.max),e},a.arrowIncrement.decimals=function(a){var b=""+a,c=b.indexOf(".");return c>=0?b.length-1-b.indexOf("."):0},a.arrowIncrement.parse=function(a){var b=a.match(/^(\D*?)(\d*(,\d{3})*(\.\d+)?)\D*$/);return b&&b[2]?b[1]&&b[1].indexOf("-")>=0?-b[2].replace(",",""):+b[2].replace(",",""):NaN},a.fn.arrowIncrement=function(b){return this.each(function(){new a.arrowIncrement(this,b)})}}(jQuery),function(a){"use strict";var b=a("#gradebook"),c=a(".marks-sheet-csv-link"),d=a(".header",b),e=a("#grades"),f=a("#total"),g=a("#assignments"),h={Launch:function(){h.downloadCSVButton(),h.finalGradeSelect(),h.assignmentGradeInputValidator(),h.assignmentGradeInputIncrementByArrows(),h.scrollButtons(),h.fileInput()},downloadCSVButton:function(){c.click(function(){return b.find(".__unsaved").length>0?(swal({title:"",text:"Сперва сохраните форму,\nчтобы скачать актуальные данные.",type:"warning",confirmButtonText:"Хорошо"}),!1):void 0})},finalGradeSelect:function(){e.find("select").each(function(){a(this).data("value",a(this).find("option").filter(function(){return a(this).prop("defaultSelected")}).val())}),b.on("change","select",function(b){var c=a(b.target);h.toggleState(c)})},assignmentGradeInputValidator:function(){g.on("change","input",function(b){var c=a(this),d=a(b.target);c.val()<0&&c.val(0);var e=c.closest(".assignment").data("max");c.val()>e&&c.val(e),c.val()!=parseInt(c.val(),10)&&c.val(""),h.toggleState(d)})},toggleState:function(a){var b,c=a.val(),d=a.data("value");"input"===a[0].nodeName.toLowerCase()?b=a:"select"===a[0].nodeName.toLowerCase()&&(b=a.parent()),c!=d?b.addClass("__unsaved"):b.removeClass("__unsaved")},assignmentGradeInputIncrementByArrows:function(){g.on("keydown",".assignment input",function(b){if(38===b.keyCode||40==b.keyCode){var c=this;void 0!==c.increment&&void 0!==c.decrement||(c.increment=a.arrowIncrement.prototype.increment,c.decrement=a.arrowIncrement.prototype.decrement),c.opts={parseFn:function(a){var b=a.match(/^(\D*?)(\d*(,\d{3})*(\.\d+)?)\D*$/);return b&&b[2]?b[1]&&b[1].indexOf("-")>=0?-b[2].replace(",",""):+b[2].replace(",",""):0==a.length?0:NaN}},c.$element=a(this),38===b.keyCode?c.increment():40===b.keyCode&&c.decrement()}})},scrollButtons:function(){d.on("click",".scroll.left",function(){h.scroll(-1,0)}),d.on("click",".scroll.right",function(){h.scroll(1,0)}),f.css("box-shadow","5px 0 5px -5px rgba(0, 0, 0, 0.4)"),g.width()<=g.find(".scrollable").width()&&d.css("visibility","visible")},scroll:function(a,b){var c=100,d=20,e=c*parseInt(a),f=5*d*parseInt(b);if(0!=e){var h=g.scrollLeft();g.scrollLeft(h+e)}if(0!=f){var i=g.scrollTop();g.scrollTop(i+f)}},fileInput:function(){a("#input-id").fileinput({showUpload:!1,language:"ru",previewFileType:"text",allowedFileTypes:["text"],allowedFileExtensions:["txt","csv"],showPreview:!1,showRemove:!1,maxFileCount:1,browseIcon:'<i class="fa fa-folder-open"></i> &nbsp;',removeIcon:'<i class="fa fa-trash"></i> ',uploadIcon:'<i class="fa fa-upload"></i> ',cancelIcon:'<i class="fa fa-times-circle-o"></i> ',msgValidationErrorIcon:'<i class="fa fa-exclamation-circle"></i> '})},restrictGradeInputChars:function(){}};a(document).ready(function(){h.Launch()})}(jQuery);