{% load lookup from core_tags %}

{% if online_test %}
    <h4>Тест: {{ online_test.score_display }} / <span>{{ campaign.online_test_max_score }}</span> {% if contests.test and contests.test.file %}Контест <a
            href="{{ contests.test.file_url }}" target="_blank">{% if online_test.yandex_contest_id %}#{{ online_test.yandex_contest_id }}{% endif %}</a>
    {% elif online_test.yandex_contest_id  %}Контест #{{ online_test.yandex_contest_id }}{% endif %}</h4>
    {# FIXME: move logic below to separated method after migrating to jinja2 #}
    {% if "titles" in contests.test.details %}
        {% if "scores" in online_test.details %}
            {% if online_test.details.scores|length != contests.test.details.titles|length %}
                Размерности заголовков и результатов тестирования не совпадают
            {% else %}
                <ul class="list-unstyled">
                {% for v in online_test.details.scores %}
                    <li>{{ contests.test.details.titles|lookup:forloop.counter0 }}: {{ v|default:"-" }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% else %}
            Результаты тестирования не найдены.
        {% endif %}
    {% else %}
        <ul class="list-unstyled">
        {% for k,v in online_test.details.items %}
            <li>{{ k }}: {{ v }}</li>
        {% endfor %}
        </ul>
    {% endif %}
    <hr>
{% else %}
    Результаты теста не найдены.
    <hr>
{% endif %}
{% if exam %}
    <h4>Экзамен: {{ exam.score_display }} / <span>{{ campaign.exam_max_score }}</span> {% if contests.exam and contests.exam.file %}Контест <a
            href="{{ contests.exam.file_url }}" target="_blank">{% if exam.yandex_contest_id %}#{{ exam.yandex_contest_id }}{% endif %}</a>{% elif exam.yandex_contest_id  %}
        Контест #{{ exam.yandex_contest_id }}{% endif %}</h4>
    <ul class="list-unstyled">
    {% for k,v in exam.details.items %}
        <li>
            {% if k == "scores" %}
                <b>Результаты</b>:<br>{% for k, v in v.items %}Задача {{ k }}: {{ v }}<br>{% endfor %}
            {% else %}
                <b>{{ k }}</b>: {{ v }}
            {% endif %}
        </li>

    {% endfor %}
    </ul>
{% else %}
    Результаты экзамена не найдены.
{% endif %}