{% extends "base.html" %}
{% load i18n %}

{% block body_class %} gray{% endblock body_class %}

{% block content %}
<div class="container _students-courses-list">
    <div class="nav-tabs-inverse">
        <ul class="nav nav-tabs nav-tabs-solid" data-plugin="nav-tabs" role="tablist">
            <li class="active" role="presentation">
                <a data-toggle="tab" href="#current" aria-controls="current" role="tab" aria-expanded="true">{{ current_term }}</a>
            </li>
            {% if enrollments_archive %}
            <li role="presentation">
                <a data-toggle="tab" href="#archive" aria-controls="archive" role="tab" aria-expanded="false">Пройденные курсы</a>
            </li>
            {% endif %}
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="current" role="tabpanel">
            {% if enrollments_ongoing or course_list_available %}

          <table class="table" width="100%">
            <thead>
                <th></th>
                <th class="actions"></th>
            </thead>
            <tbody>
            {% for e in enrollments_ongoing %}
            <tr class="{{ e.course_offering.has_unread|yesno:"unread,noop" }}">
                <td>
                <a href="{{ e.course_offering.get_absolute_url }}" class="title">{{ e.course_offering.course.name }}</a> &nbsp;
                  <span class="badge assignment-status {{ e.course_offering.grading_type_css_mixin }} {{ e.grade }}">{{ e.grade_honest }}</span><br>
              {% trans "Professors" %}:
                {% for teacher in e.course_offering.teachers.all %}
                <a href="{% url 'teacher_detail' teacher.pk %}">{{ teacher.get_abbreviated_name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
                </td>
                <td>
                    {% if e.course_offering.survey_url %}<a class=" btn btn-sm btn-block btn-success" href="{{ e.course_offering.survey_url }}" target="_blank">{% trans "Start survey!" %}</a>{% endif %}
                    {% if e.course_offering.enrollment_is_open %}
                    <a href="{% url 'course_offering_unenroll' e.course_offering.course.slug e.course_offering.semester.slug %}?back=course_list_student"
                       class=" btn btn-sm btn-block btn-warning">{% trans "Leave course" %}
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}

            {% for course_offering in course_list_available %}
            <tr class="{{ course_offering.has_unread|yesno:"unread,noop" }}">
              <td>
                <a class="title" href="{{ course_offering.get_absolute_url }}">
                    {{ course_offering.course.name }}</a>{% if request.site.domain == "compscicenter.ru" and course_offering.is_open %}<span>, курс CS клуба</span>{% endif %}<br>
              {% trans "Professors" %}:
                {% for teacher in course_offering.teachers.all %}
                <a href="{% url 'teacher_detail' teacher.pk %}">{{ teacher.get_abbreviated_name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
              </td>
              <td>
                  {% if course_offering.enrollment_is_open %}

                <form method="post" action="{% url 'course_offering_enroll' course_offering.course.slug course_offering.semester.slug %}">
                {% csrf_token %}
                <input type="hidden" name="course_offering_pk" value="{{ course_offering.pk }}">
                <input type="hidden" name="back" value="course_list_student">
                <button type="submit" class="btn btn-default btn-sm btn-block">
                  {% trans "Enroll" %}
                </button>
              </form>
                  {% endif %}
              </td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
            {% else %}
                Список курсов на <b>{{ current_term|lower }}</b> пуст.
            {% endif %}
          </div>

      {% if enrollments_archive %}
          <div class="tab-pane" id="archive" role="tabpanel">
          <table class="table _archive" width="100%">
            <thead>
              <th></th>
              <th width="10%">{% trans "Grade" %}</th>
              <th width="15%">{% trans "Semester" %}</th>
            </thead>
            <tbody>
            {% for e in enrollments_archive %}
                <tr class="{{ e.course_offering.has_unread|yesno:"unread,noop" }}">
                  <td>
                    <a href="{{ e.course_offering.get_absolute_url }}">
                      {{ e.course_offering.course.name }}</a>
                  </td>
                  <td><span class="badge assignment-status {{ e.course_offering.grading_type_css_mixin }} {{ e.grade }}">{{ e.grade_honest }}</span></td>
                  <td>{{ e.course_offering.semester }}</td>
                </tr>
            {% endfor %}
            </tbody>
          </table>
          </div>
      {% endif %}

        {% if not enrollments_ongoing and not enrollments_archive and not course_list_available %}
            <div class="container center-aligned"><h5>{% trans "No courses yet" %}</h5></div>
        {% endif %}
    </div>
    </div>
</div>

{% endblock content %}
