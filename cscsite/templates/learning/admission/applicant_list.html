{% extends "base.html" %}
{% load i18n %}
{% load bootstrap_pagination %}
{% load crispy_forms_tags %}

{% block title %}Анкеты - CSC{% endblock title %}

{% block body_class %} gray{% endblock body_class %}

{% block content %}
<div class="admission-list-page">
    {% crispy filter.form %}

    <div class="page-content">
      <div class="panel">
        <div class="panel-heading">
          <h3 class="panel-title">Поступающие / {{ paginator.count }}</h3>
        </div>

        <div class="panel-body">
          <table class="table">
            <thead>
              <tr>
                <th>Поступающий</th>
                <th>Набор</th>
                <th>Направление</th>
                <th>Тест</th>
                <th>Экзамен</th>
                {% if request.user.is_curator %}<th>#</th>{% endif %}
              </tr>
            </thead>
            <tbody>
                {% for applicant in applicants %}
                    <tr>
                        <td class="applicant">
                            <a href="{%  url "admission_applicant_detail" applicant.pk %}">{{ applicant.get_full_name }}</a><br>
                            {{ applicant.university }}
                            {% if applicant.course %}<br><b>Курс</b>: {{ applicant.course }}{% endif %}
                        </td>
                        <td>{{ applicant.campaign.year }}</td>
                        <td>{{ applicant.preferred_study_programs }}</td>
                        <td>{{ applicant.online_test.score|default:"-" }}</td>
                        <td>{{ applicant.exam.score|default:"-" }}</td>
                        {% if request.user.is_curator %}
                        <td>
                            {% if applicant.user_id %}
                                <a title="Профиль на сайте" class="btn btn-link" href="{% url "user_detail" applicant.user_id %}" target="_blank"><i class="fa fa-2x fa-external-link" aria-hidden="true"></i></a>
                            {% elif applicant.interview_successfull and applicant.campaign.current %}
                                <form method="post" action="{% url "admission_applicant_create_user" applicant.pk %}">
                                    {% csrf_token %}
                                    <button title="Создать профиль на сайте" type="submit" class="btn btn-link"><i class="fa fa-2x fa-user-plus" aria-hidden="true"></i></button>
                                </form>
                            {% endif %}
                        </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
          </table>

        {% if is_paginated %}
            {% bootstrap_paginate page_obj range=10 show_prev_next="false" show_first_last="true" last_label="<i class='fa fa-angle-double-right'></i>" first_label="<i class='fa fa-angle-double-left'></i>" %}
        {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
