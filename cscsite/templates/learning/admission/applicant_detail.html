{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load crispy_forms_tags %}
{% load static %}
{% load markdown from core_tags %}

{% block title %} Анкета {{ applicant.campaign.code }} - {{ applicant.get_full_name }}{% endblock title %}

{% block body_class %} gray{% endblock body_class %}


{% block stylesheets %}
    <link href="{% static "css/vendor/bootstrap-datetimepicker.min.css" %}" rel="stylesheet">
{% endblock stylesheets %}

{% block javascripts %}
    {# TODO: Can't add js without pain in Meta class of django form. Rewrite with django-sekizai after investigation    #}
    <script type="text/javascript" src="{% static "js/vendor/moment/moment-with-locales.min.js" %}"></script>
    <script type="text/javascript" src="{% static "js/vendor/bootstrap-datetimepicker.min.js" %}"></script>
    <script type="text/javascript">
        $(function () {
            $('.datetimeinput').datetimepicker({
                locale: 'ru',
                stepping: 5,
                collapse: false,
                sideBySide: true,
                toolbarPlacement: "bottom",
                keyBinds: {
                    left: false,
                    right: false,
                },
                showClose: true,
                icons: {
                    time: 'fa fa-clock-o',
                    date: 'fa fa-calendar',
                    up: 'fa fa-chevron-up',
                    down: 'fa fa-chevron-down',
                    previous: 'fa fa-chevron-left',
                    next: 'fa fa-chevron-right',
                    today: 'fa fa-screenshot',
                    clear: 'fa fa-trash',
                    close: 'fa fa-remove'
                }
            });

            var hash = window.location.hash;
            hash && $('ul.nav a[href="' + hash + '"]').tab('show');

            $('.nav-tabs a').click(function (e) {
                $(this).tab('show');
                var scrollmem = $('body').scrollTop() || $('html').scrollTop();
                $('html,body').scrollTop(scrollmem);
            });
        });
    </script>
{% endblock javascripts %}

{% block content %}
<div class="admission-applicant-page">
    <div class="page-header">
        <h3 class="page-title">{{ applicant.get_full_name }}</h3>
        <ol class="breadcrumb">
            <li><a href="{% url "admission_applicants" %}">Список поступающих</a></li>
            <li class="active">{{ applicant.get_full_name }}</li>
        </ol>
        {% if request.user.is_curator %}
            <div class="page-header-actions">
                <a class="edit-interview-btn"
                   href="{% url "admin:admission_applicant_change" applicant.pk %}" target="_blank"><i class="icon fa fa-cog"></i></a>
            </div>
        {% endif %}
    </div>
    <div class="additional-info">{{ applicant.campaign }}<br>Статус: {{ applicant.get_status_display|default_if_none:"<не указан>" }}</div>
    <div class="nav-tabs-horizontal nav-tabs-inverse">
      <ul class="nav nav-tabs nav-tabs-solid" data-plugin="nav-tabs" role="tablist">
        <li role="presentation" class="active">
          <a data-toggle="tab" href="#applicant" aria-controls="applicant" role="tab" aria-expanded="false">Анкета поступающего</a>
        </li>
          <li role="presentation" class="">
          <a data-toggle="tab" href="#test-results" aria-controls="test-results" role="tab" aria-expanded="false">Тест и экзамен</a>
        </li>
          <li role="presentation" class="">
          <a data-toggle="tab" href="#similar-applicants" aria-controls="similar-applicants" role="tab" aria-expanded="false">Похожие анкеты</a>
        </li>
          {% if request.user.is_curator and applicant.campaign.current %}
          <li role="presentation" class="">
          <a data-toggle="tab" href="#create" aria-controls="create" role="tab" aria-expanded="false">Назначить собеседование</a>
        </li>
          <li role="presentation" class="">
          <a data-toggle="tab" href="#update-status-form" aria-controls="update-status-form" role="tab" aria-expanded="false">Статус</a>
        </li>
          {% endif %}
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="applicant" role="tabpanel">
            <dl>
            {% for field in applicant_form %}
                <dt>{{ field.label_tag }}</dt>
                <dd>{% if field.value %}{{ field.value|linebreaks }}{% else %}<не указано>{% endif %}</dd>
            {% endfor %}
            </dl>
        </div>
        <div class="tab-pane" id="test-results" role="tabpanel">
            {% if online_test %}
                <h4>Тест: {{ online_test.score|floatformat }} / <span>{{ campaign.online_test_max_score }}</span> {% if contests.test %}<a
                        href="{{ contests.test.file_url }}" target="_blank">Описание задач контеста{% if online_test.yandex_contest_id %}
                    #{{ online_test.yandex_contest_id }}{% endif %}</a>
                {% elif online_test.yandex_contest_id  %}Контест #{{ online_test.yandex_contest_id }}{% endif %}</h4>
                <ul class="list-unstyled">
                {% for k,v in online_test.details.items %}
                    <li>{{ k }}: {{ v }}</li>
                {% endfor %}
                </ul>
                <hr>
            {% else %}
                Результаты теста не найдены.
                <hr>
            {% endif %}
            {% if exam %}
                <h4>Экзамен: {{ exam.score|floatformat }} / <span>{{ campaign.exam_max_score }}</span> {% if contests.exam %}<a
                        href="{{ contests.exam.file_url }}" target="_blank">Описание задач контеста{% if exam.yandex_contest_id %}
                    #{{ exam.yandex_contest_id }}{% endif %}</a>{% elif exam.yandex_contest_id  %}
                    Контест #{{ exam.yandex_contest_id }}{% endif %}</h4>
                <ul class="list-unstyled">
                {% for k,v in exam.details.items %}
                    <li>{{ k }}: {{ v }}</li>
                {% endfor %}
                </ul>
            {% else %}
                Результаты экзамена не найдены.
            {% endif %}
        </div>
        <div class="tab-pane" id="similar-applicants" role="tabpanel">
            {% for applicant in similar_applicants %}
                <a target="_blank" href="{% url "admission_applicant_detail" applicant.pk %}">{{ applicant.get_full_name }} ({{ applicant.campaign.name }})</a><br>
            {% empty %}
                Похожие анкеты не найдены.
            {% endfor %}
        </div>
      {% if request.user.is_curator and applicant.campaign.current %}
          <div class="tab-pane" id="create" role="tabpanel">
              {% crispy form %}
                <div class="clearfix"></div>
          </div>
          <div class="tab-pane" id="update-status-form" role="tabpanel">
              {% crispy status_form %}
              <div class="clearfix"></div>
          </div>
      {% endif %}
    </div>
    </div>
</div>
{% endblock content %}
