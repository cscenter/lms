{% extends "base.html" %}
{% load i18n %}
{% load thumbnail %}
{% load core_tags %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-xs-12 h2-and-buttons">
      <h2>{{ user_object.get_full_name }}</h2>
      <div class="btn-toolbar">
        {% if is_editing_allowed %}
        <a href="{% url 'user_update' user_object.pk %}" class="btn btn-primary" role="button">{% trans "Edit" %}</a>
        {% endif %}
        {% if create_reference_allowed and user_object.is_student or user_object.enrollment_year %}
        <a href="{% url 'user_reference_add' user_object.pk %}" class="btn btn-primary" role="button">{% trans "Create reference" %}</a>
        {% endif %}
        {% if request.user.is_staff and user_object.studentinfo %}
        <a href="{% url 'student_info_update' user_object.studentinfo.pk %}" class="btn btn-primary" role="button">{% trans "Edit info record" %}</a>
        {% endif %}
        {% if user_object.pk == user.pk %}
        <a href="{% url 'password_change' %}" class="btn btn-primary" role="button">{% trans "Change password" %}</a>
        {% endif %}
      </div>
      <hr>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-9">
      {% if user_object.note %}
      <div class="ubertext">{{ user_object.note }}</div>
      {% endif %}
      <ul class="">
        {% if user_object.is_student or user_object.enrollment_year %}
        <li>
          {% trans "student" %},
          {% trans "enrolled in" %} {{ user_object.enrollment_year }}{% if user_object.enrollment_set.all %}, {% trans "courseoffering|took" %}:
          <ul>
            {% for enrollment in user_object.enrollment_set.all %}
            <li>
              <a href="{% url 'course_offering_detail' enrollment.course_offering.course.slug enrollment.course_offering.semester.slug %}">
                {{ enrollment.course_offering }}
              </a>
              {% if is_extended_profile_available %}
              ({{ enrollment.grade_display|lower }})
              {% endif %}
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        {% if student_projects %}
        {% trans "Student projects"|lower %}:
          <ul>
            {% for project in student_projects %}
            <li>
              {{ project.semesters_list|join:", " }}:
              «{{ project.name }}»{% if project.presentation %} (<a href="{{ project.presentation.url }}">{% trans "Presentation"|lower %}</a>){% endif %},
              {% trans "StudentProject|Supervisor"|lower %} — {{ project.supervisor }}
              {% if project.description %}
              <div class="ubertext">
                {{ project.description }}
              </div>
              {% endif %}
            </li>
            {% endfor %}
          </ul>
        {% endif %}
        </li>
        {% endif %}
        {% if user_object.is_graduate %}
        <li>
          {% blocktrans with year=user_object.graduation_year %}graduated in {{ year }}{% endblocktrans %}
        </li>
        {% endif %}
        {% if user_object.is_teacher %}
        <li>{% trans "teacher" %}{% if user_object.teaching_set.all %}:{% endif %}
          <ul class="">
            {% for courseoffering in user_object.teaching_set.all %}
            <li>
              <a href="{% url 'course_offering_detail' courseoffering.course.slug courseoffering.semester.slug %}">
                {{ courseoffering }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </li>
        {% endif %}
      </ul>
      {% if user_object.csc_review %}
      <h4>{% blocktrans with name=user_object.first_name %}{{name}} about CSC{% endblocktrans %}:</h4>
      <div class="ubertext">
        {{ user_object.csc_review }}
      </div>
      {% endif %}
      {% if user.is_authenticated and user_object.private_contacts %}
      <h4>{% trans "Contact information" %}:</h4>
      <div class="ubertext">
        {{ user_object.private_contacts }}
      </div>
      {% endif %}
      {% if user_object.pk == user.pk %}
      <table>
        <tr>
          <td>{% trans ".iCal classes calendar" %}:</td>
          <td>
            <input type="text" value="http://{{ request.get_host }}{% url 'user_ical_classes' user.pk %}"
                   disabled="disabled" size="50">
          </td>
        </tr>
        <tr>
          <td>{% trans ".iCal assignments calendar" %}:</td>
          <td>
            <input type="text" value="http://{{ request.get_host }}{% url 'user_ical_assignments' user.pk %}"
                   disabled="disabled" size="50">
          </td>
        </tr>
        <tr>
          <td>{% trans ".iCal events calendar" %}:</td>
          <td>
            <input type="text" value="http://{{ request.get_host }}{% url 'ical_events' %}"
                   disabled="disabled" size="50">
          </td>
        </tr>
      </table>
      {% endif %}
      {% if a_ss %}
        <h4 class="bigger-margin">{% trans "Assignments" %}:
          <div class="btn-group pull-right assignment-list-control" role="group">
            <button type="button" class="btn btn-xs btn-default active current-semester">{{ current_semester }}</button>
            <button type="button" class="btn btn-xs btn-default all">{% trans "All"|lower %}</button>
          </div></h4>
        <table class="table table-condensed" id="assignments-table">
          <tr>
            <th>{% trans "Course offering" %}</th>
            <th>{% trans "Assignment" %}</th>
            <th>{% trans "Grade" %}</th>
          </tr>
          {% for a_s in a_ss %}
            <tr {% if a_s.assignment.course_offering.semester_id != current_semester.id %}
                   class="old" style="display:none;"
                {% endif %}>
              <td>
                {% if a_s.hacky_co_change %}
                  <a href="{{ a_s.assignment.course_offering.get_absolute_url }}">{{ a_s.assignment.course_offering }}</a>
                {% else %}
                  <span style="color: #CCC">—〃—</span>
                {% endif %}
              </td>
              <td>
                <a href="{% url 'a_s_detail_teacher' a_s.pk %}">
                  {{ a_s.assignment.title }}
                </a>
              </td>
              <td>
                <span style="white-space: nowrap;"
                      class="badge assignment-status {{ a_s.state|to_css }}">
                  {{ a_s.state_display }}
                </span>
              </td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
      {% with borrows=user_object.borrows.all %}
      {% if request.user.is_staff and borrows %}
      <h4 class="bigger-margin">{% trans "books" %}:</h4>
      <ul>
        {% for borrow in borrows %}
        <li><a href="{{ borrow.book.get_absolute_url }}">{{ borrow.book.title }}</a></li>
        {% endfor %}
      </ul>
      {% endif %}
      {% endwith %}
      {% if request.user.is_staff and user_object.is_student %}
      <h4 class="bigger-margin">{% trans "Student info record" %}:</h4>
      <table class="table table-condensed">
        <tr>
          <td width="25%">{% trans "University" %}:</td>
          <td>{{ user_object.university|default:"—" }}</td>
        </tr>
        <tr>
          <td>{% trans "Phone" %}:</td>
          <td>{{ user_object.phone|default:"—" }}</td>
        </tr>
        <tr>
          <td>{% trans "Yandex ID" %}:</td>
          <td>{{ user_object.yandex_id|default:"—" }}</td>
        </tr>
        <tr>
          <td>{% trans "Github ID" %}:</td>
          <td>
            {% if user_object.github_id %}
              <a href="https://github.com/{{ user_object.github_id }}" target="_blank">{{ user_object.github_id }}</a>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        <tr>
          <td>{% trans "Stepic ID" %}:</td>
          <td>
            {% if user_object.stepic_id %}
              <a href="https://stepic.org/users/{{ user_object.stepic_id }}" target="_blank">{{ user_object.stepic_id }}</a>
            {% else %}
              —
            {% endif %}
          </td>
        </tr>
        <tr>
          <td>{% trans "StudentInfo|University year" %}:</td>
          <td>{{ user_object.uni_year_at_enrollment|default:"—" }}</td>
        </tr>
        <tr>
          <td>{% trans "Comment" %}:</td>
          <td>
            <div class="ubertext">
              {{ user_object.comment|default:"—" }}
            </div>
            {% if user_object.comment %}
            <span class="student-comment-metainfo pull-right">
              {{ user_object.comment_last_author.get_short_name }}{% if user_object.comment_last_author %}, {% endif %}
              {{ user_object.comment_changed_at|date:"d.m.Y H:i" }}
            </span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td>{% trans "Status" %}:</td>
          <td>
            {{ user_object.get_status_display|default:"—" }}
            {% if user_object.nondegree %}
            ({% trans "Non-degree student"|lower %})
            {% endif %}
          </td>
        </tr>
        <tr>
          <td>{% trans "StudentInfo|Study program" %}:</td>
          <td>
            {% with sps=user_object.study_programs.all %}
            {% if sps %}
            <ul class="list-unstyled">
              {% for sp in sps %}
              <li>{{ sp.name }}</li>
              {% endfor %}
            </ul>
            {% else %}
            —
            {% endif %}
            {% endwith %}
          </td>
        </tr>
        <tr>
          <td>{% trans "Online courses" %}:</td>
          <td>
            {% with recs=user_object.onlinecourserecord_set.all %}
            {% if recs %}
            <ol>
              {% for rec in recs %}
              <li>{{ rec.name }}</li>
              {% endfor %}
            </ol>
            {% else %}
            —
            {% endif %}
            {% endwith %}
          </td>
        </tr>
        <tr>
          <td>{% trans "School of Data Analysis courses" %}:</td>
          <td>
            {% with recs=user_object.shadcourserecord_set.all %}
            {% if recs %}
            <ol>
              {% for rec in recs %}
              <li>{{ rec.name }}</li>
              {% endfor %}
            </ol>
            {% else %}
            —
            {% endif %}
            {% endwith %}
          </td>
        </tr>
        <tr>
          <td>{% trans "Workplace" %}:</td>
          <td>{{ user_object.workplace|default:"—" }}</td>
        </tr>
      </table>
      {% endif %}

      {% if request.user.is_superuser and user_object.is_student and  user_object.cscuserreference_set.count > 0 %}
        <h4 class="bigger-margin">{% trans "Student references" %}:</h4>
          <ul>
            {% for reference in user_object.cscuserreference_set.all %}
            <li>
              <a href="{% url 'user_reference_detail' user_object.id reference.id %}">
                {{ reference.created|date:"d.m.Y" }}
              </a>
            </li>
            {% endfor %}
          </ul>
      {% endif %}

    </div>
    <div class="col-xs-3">
      {% thumbnail user_object.photo "200x200" crop="center" as im %}
      <img class="pull-right" src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
      {% endthumbnail %}
    </div>
  </div>
</div>
{% endblock content %}
